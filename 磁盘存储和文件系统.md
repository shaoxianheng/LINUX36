[**磁盘存储和文件系统**]()

磁盘结构

分区类型

管理分区

管理文件系统

挂载设备

管理虚拟内存

RAID管理

LVM管理

LVM快照

```
root@node1 ~]# find /dev/ -type b
/dev/dm-1
/dev/dm-0
/dev/sr0
/dev/sda2
/dev/sda1
/dev/sda
[root@node1 ~]# find /dev/ -type b -ls
 10466    0 brw-rw----   1 root     disk     253,   1 Sep  3 20:03 /dev/dm-1
 10403    0 brw-rw----   1 root     disk     253,   0 Sep  3 20:03 /dev/dm-0
 10267    0 brw-rw----   1 root     cdrom     11,   0 Sep  3 20:03 /dev/sr0
 10258    0 brw-rw----   1 root     disk       8,   2 Sep  3 20:03 /dev/sda2
 10257    0 brw-rw----   1 root     disk       8,   1 Sep  3 20:03 /dev/sda1
 10254    0 brw-rw----   1 root     disk       8,   0 Sep  3 20:03 /dev/sda
[root@node1 ~]# 

```

创建一个11 ，0 的设备

```
[root@node1 ~]# find /dev/ -type b -ls
 10466    0 brw-rw----   1 root     disk     253,   1 Sep  3 20:03 /dev/dm-1
 10403    0 brw-rw----   1 root     disk     253,   0 Sep  3 20:03 /dev/dm-0
 10267    0 brw-rw----   1 root     cdrom     11,   0 Sep  3 20:03 /dev/sr0
 10258    0 brw-rw----   1 root     disk       8,   2 Sep  3 20:03 /dev/sda2
 10257    0 brw-rw----   1 root     disk       8,   1 Sep  3 20:03 /dev/sda1
 10254    0 brw-rw----   1 root     disk       8,   0 Sep  3 20:03 /dev/sda
[root@node1 ~]# mknod /dev/cd b 11 0
You have new mail in /var/spool/mail/root
[root@node1 ~]# ll /dev/cd
brw-r--r--. 1 root root 11, 0 Sep  3 21:15 /dev/cd

```

挂在设备

```
[root@node1 ~]# mount /dev/cd /mnt
mount: /dev/cd is write-protected, mounting read-only
[root@node1 ~]# cd /mnt/
[root@node1 mnt]# ls
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL

```

怎么查看是机械和固态

1为机械

0为固态

```
[root@node1 mnt]# cat /sys/block/sda/queue/rotational 
1

```

```
[root@node1 mnt]# fdisk /dev/sda -l

Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x00039d2d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200    41943039    19921920   8e  Linux LVM

```

按照柱面显示

```
[root@node1 mnt]# fdisk -l -u=cylinder

Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x00039d2d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1         131     1048576   83  Linux
/dev/sda2             131        2611    19921920   8e  Linux LVM


```

**使用分区空间**

分区--》格式化--》挂载 

**磁盘分区**

为什么分区 

读取硬盘上的前521个字节

```
[root@node1 mnt]# hexdump -C -n 512 /dev/sda
00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 80 01 00 00 00  |................|
00000060  00 00 00 00 ff fa 90 90  f6 c2 80 74 05 f6 c2 70  |...........t...p|
00000070  74 02 b2 80 ea 79 7c 00  00 31 c0 8e d8 8e d0 bc  |t....y|..1......|
00000080  00 20 fb a0 64 7c 3c ff  74 02 88 c2 52 be 05 7c  |. ..d|<.t...R..||
00000090  b4 41 bb aa 55 cd 13 5a  52 72 3d 81 fb 55 aa 75  |.A..U..ZRr=..U.u|
000000a0  37 83 e1 01 74 32 31 c0  89 44 04 40 88 44 ff 89  |7...t21..D.@.D..|
000000b0  44 02 c7 04 10 00 66 8b  1e 5c 7c 66 89 5c 08 66  |D.....f..\|f.\.f|
000000c0  8b 1e 60 7c 66 89 5c 0c  c7 44 06 00 70 b4 42 cd  |..`|f.\..D..p.B.|
000000d0  13 72 05 bb 00 70 eb 76  b4 08 cd 13 73 0d 5a 84  |.r...p.v....s.Z.|
000000e0  d2 0f 83 de 00 be 85 7d  e9 82 00 66 0f b6 c6 88  |.......}...f....|
000000f0  64 ff 40 66 89 44 04 0f  b6 d1 c1 e2 02 88 e8 88  |d.@f.D..........|
00000100  f4 40 89 44 08 0f b6 c2  c0 e8 02 66 89 04 66 a1  |.@.D.......f..f.|
00000110  60 7c 66 09 c0 75 4e 66  a1 5c 7c 66 31 d2 66 f7  |`|f..uNf.\|f1.f.|
00000120  34 88 d1 31 d2 66 f7 74  04 3b 44 08 7d 37 fe c1  |4..1.f.t.;D.}7..|
00000130  88 c5 30 c0 c1 e8 02 08  c1 88 d0 5a 88 c6 bb 00  |..0........Z....|
00000140  70 8e c3 31 db b8 01 02  cd 13 72 1e 8c c3 60 1e  |p..1......r...`.|
00000150  b9 00 01 8e db 31 f6 bf  00 80 8e c6 fc f3 a5 1f  |.....1..........|
00000160  61 ff 26 5a 7c be 80 7d  eb 03 be 8f 7d e8 34 00  |a.&Z|..}....}.4.|
00000170  be 94 7d e8 2e 00 cd 18  eb fe 47 52 55 42 20 00  |..}.......GRUB .|
00000180  47 65 6f 6d 00 48 61 72  64 20 44 69 73 6b 00 52  |Geom.Hard Disk.R|
00000190  65 61 64 00 20 45 72 72  6f 72 0d 0a 00 bb 01 00  |ead. Error......|
000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....<.u........|
000001b0  00 00 00 00 00 00 00 00  2d 9d 03 00 00 00 80 20  |........-...... |
000001c0  21 00 83 aa 28 82 00 08    00 aa  |!...(....... ...|
000001d0  29 82 8e fe ff ff 00 08  20 00 00 f8 5f 02 00 00  |)....... ..._...|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200

```

备份分区表：

```
[root@node1 mnt]# dd if=/dev/sda of=/data/dpt bs=1 count=66 skip=446
66+0 records in
66+0 records out
66 bytes (66 B) copied, 0.000208882 s, 316 kB/s
[root@node1 mnt]# 

```

查看

```
[root@node1 mnt]# xxd /data/dpt
0000000: 8020 2100 83aa 2882 0008 0000 0000 2000  . !...(....... .
0000010: 00aa 2982 8efe ffff 0008 2000 00f8 5f02  ..)....... ..._.
0000020: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0000040: 55aa                                     U.
[root@node1 mnt]# 
[root@node1 mnt]# 
[root@node1 mnt]# hexdump -C /data/dpt 
00000000  80 20 21 00 83 aa 28 82  00 08 00 00 00 00 20 00  |. !...(....... .|
00000010  00 aa 29 82 8e fe ff ff  00 08 20 00 00 f8 5f 02  |..)....... ..._.|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000040  55 aa                                             |U.|
00000042

```

修改55aa：seek表示跳过sda510个字节

```
[root@node1 mnt]# dd if=/dev/zero of=/dev/sda bs=1 count=2 seek=510
2+0 records in
2+0 records out
2 bytes (2 B) copied, 0.000163053 s, 12.3 kB/s
[root@node1 mnt]# hexdump -C -n 512 /dev/sda
00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 80 01 00 00 00  |................|
00000060  00 00 00 00 ff fa 90 90  f6 c2 80 74 05 f6 c2 70  |...........t...p|
00000070  74 02 b2 80 ea 79 7c 00  00 31 c0 8e d8 8e d0 bc  |t....y|..1......|
00000080  00 20 fb a0 64 7c 3c ff  74 02 88 c2 52 be 05 7c  |. ..d|<.t...R..||
00000090  b4 41 bb aa 55 cd 13 5a  52 72 3d 81 fb 55 aa 75  |.A..U..ZRr=..U.u|
000000a0  37 83 e1 01 74 32 31 c0  89 44 04 40 88 44 ff 89  |7...t21..D.@.D..|
000000b0  44 02 c7 04 10 00 66 8b  1e 5c 7c 66 89 5c 08 66  |D.....f..\|f.\.f|
000000c0  8b 1e 60 7c 66 89 5c 0c  c7 44 06 00 70 b4 42 cd  |..`|f.\..D..p.B.|
000000d0  13 72 05 bb 00 70 eb 76  b4 08 cd 13 73 0d 5a 84  |.r...p.v....s.Z.|
000000e0  d2 0f 83 de 00 be 85 7d  e9 82 00 66 0f b6 c6 88  |.......}...f....|
000000f0  64 ff 40 66 89 44 04 0f  b6 d1 c1 e2 02 88 e8 88  |d.@f.D..........|
00000100  f4 40 89 44 08 0f b6 c2  c0 e8 02 66 89 04 66 a1  |.@.D.......f..f.|
00000110  60 7c 66 09 c0 75 4e 66  a1 5c 7c 66 31 d2 66 f7  |`|f..uNf.\|f1.f.|
00000120  34 88 d1 31 d2 66 f7 74  04 3b 44 08 7d 37 fe c1  |4..1.f.t.;D.}7..|
00000130  88 c5 30 c0 c1 e8 02 08  c1 88 d0 5a 88 c6 bb 00  |..0........Z....|
00000140  70 8e c3 31 db b8 01 02  cd 13 72 1e 8c c3 60 1e  |p..1......r...`.|
00000150  b9 00 01 8e db 31 f6 bf  00 80 8e c6 fc f3 a5 1f  |.....1..........|
00000160  61 ff 26 5a 7c be 80 7d  eb 03 be 8f 7d e8 34 00  |a.&Z|..}....}.4.|
00000170  be 94 7d e8 2e 00 cd 18  eb fe 47 52 55 42 20 00  |..}.......GRUB .|
00000180  47 65 6f 6d 00 48 61 72  64 20 44 69 73 6b 00 52  |Geom.Hard Disk.R|
00000190  65 61 64 00 20 45 72 72  6f 72 0d 0a 00 bb 01 00  |ead. Error......|
000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....<.u........|
000001b0  00 00 00 00 00 00 00 00  2d 9d 03 00 00 00 80 20  |........-...... |
000001c0  21 00 83 aa 28 82 00 08  00 00 00 00 20 00 00 aa  |!...(....... ...|
000001d0  29 82 8e fe ff ff 00 08  20 00 00 f8 5f 02 00 00  |)....... ..._...|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000200

```

查看还有没有分区

```
[root@node1 mnt]# fdisk -l /dev/sda

Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

[root@node1 mnt]# 

```

内存里的分区表

```
[root@node1 mnt]# lsblk 
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sr0                    11:0    1  8.1G  0 rom  /mnt
[root@node1 mnt]# 

```

恢复55aa：

```
[root@node1 mnt]# dd if=/data/dpt of=/dev/sda bs=1 count=2 skip=64 seek=510
2+0 records in
2+0 records out
2 bytes (2 B) copied, 9.6181e-05 s, 20.8 kB/s
You have new mail in /var/spool/mail/root
[root@node1 mnt]# 
[root@node1 mnt]# hexdump -C -n 512 /dev/sda
00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 80 01 00 00 00  |................|
00000060  00 00 00 00 ff fa 90 90  f6 c2 80 74 05 f6 c2 70  |...........t...p|
00000070  74 02 b2 80 ea 79 7c 00  00 31 c0 8e d8 8e d0 bc  |t....y|..1......|
00000080  00 20 fb a0 64 7c 3c ff  74 02 88 c2 52 be 05 7c  |. ..d|<.t...R..||
00000090  b4 41 bb aa 55 cd 13 5a  52 72 3d 81 fb 55 aa 75  |.A..U..ZRr=..U.u|
000000a0  37 83 e1 01 74 32 31 c0  89 44 04 40 88 44 ff 89  |7...t21..D.@.D..|
000000b0  44 02 c7 04 10 00 66 8b  1e 5c 7c 66 89 5c 08 66  |D.....f..\|f.\.f|
000000c0  8b 1e 60 7c 66 89 5c 0c  c7 44 06 00 70 b4 42 cd  |..`|f.\..D..p.B.|
000000d0  13 72 05 bb 00 70 eb 76  b4 08 cd 13 73 0d 5a 84  |.r...p.v....s.Z.|
000000e0  d2 0f 83 de 00 be 85 7d  e9 82 00 66 0f b6 c6 88  |.......}...f....|
000000f0  64 ff 40 66 89 44 04 0f  b6 d1 c1 e2 02 88 e8 88  |d.@f.D..........|
00000100  f4 40 89 44 08 0f b6 c2  c0 e8 02 66 89 04 66 a1  |.@.D.......f..f.|
00000110  60 7c 66 09 c0 75 4e 66  a1 5c 7c 66 31 d2 66 f7  |`|f..uNf.\|f1.f.|
00000120  34 88 d1 31 d2 66 f7 74  04 3b 44 08 7d 37 fe c1  |4..1.f.t.;D.}7..|
00000130  88 c5 30 c0 c1 e8 02 08  c1 88 d0 5a 88 c6 bb 00  |..0........Z....|
00000140  70 8e c3 31 db b8 01 02  cd 13 72 1e 8c c3 60 1e  |p..1......r...`.|
00000150  b9 00 01 8e db 31 f6 bf  00 80 8e c6 fc f3 a5 1f  |.....1..........|
00000160  61 ff 26 5a 7c be 80 7d  eb 03 be 8f 7d e8 34 00  |a.&Z|..}....}.4.|
00000170  be 94 7d e8 2e 00 cd 18  eb fe 47 52 55 42 20 00  |..}.......GRUB .|
00000180  47 65 6f 6d 00 48 61 72  64 20 44 69 73 6b 00 52  |Geom.Hard Disk.R|
00000190  65 61 64 00 20 45 72 72  6f 72 0d 0a 00 bb 01 00  |ead. Error......|
000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....<.u........|
000001b0  00 00 00 00 00 00 00 00  2d 9d 03 00 00 00 80 20  |........-...... |
000001c0  21 00 83 aa 28 82 00 08  00 00 00 00 20 00 00 aa  |!...(....... ...|
000001d0  29 82 8e fe ff ff 00 08  20 00 00 f8 5f 02 00 00  |)....... ..._...|
000001e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200

```

清楚分区表64个字节

```
[root@node1 mnt]# dd if=/dev/zero of=/dev/sda bs=1 count=64 seek=446
64+0 records in
64+0 records out
64 bytes (64 B) copied, 0.000115397 s, 555 kB/s
[root@node1 mnt]# hexdump -C -n 512 /dev/sda
00000000  eb 63 90 10 8e d0 bc 00  b0 b8 00 00 8e d8 8e c0  |.c..............|
00000010  fb be 00 7c bf 00 06 b9  00 02 f3 a4 ea 21 06 00  |...|.........!..|
00000020  00 be be 07 38 04 75 0b  83 c6 10 81 fe fe 07 75  |....8.u........u|
00000030  f3 eb 16 b4 02 b0 01 bb  00 7c b2 80 8a 74 01 8b  |.........|...t..|
00000040  4c 02 cd 13 ea 00 7c 00  00 eb fe 00 00 00 00 00  |L.....|.........|
00000050  00 00 00 00 00 00 00 00  00 00 00 80 01 00 00 00  |................|
00000060  00 00 00 00 ff fa 90 90  f6 c2 80 74 05 f6 c2 70  |...........t...p|
00000070  74 02 b2 80 ea 79 7c 00  00 31 c0 8e d8 8e d0 bc  |t....y|..1......|
00000080  00 20 fb a0 64 7c 3c ff  74 02 88 c2 52 be 05 7c  |. ..d|<.t...R..||
00000090  b4 41 bb aa 55 cd 13 5a  52 72 3d 81 fb 55 aa 75  |.A..U..ZRr=..U.u|
000000a0  37 83 e1 01 74 32 31 c0  89 44 04 40 88 44 ff 89  |7...t21..D.@.D..|
000000b0  44 02 c7 04 10 00 66 8b  1e 5c 7c 66 89 5c 08 66  |D.....f..\|f.\.f|
000000c0  8b 1e 60 7c 66 89 5c 0c  c7 44 06 00 70 b4 42 cd  |..`|f.\..D..p.B.|
000000d0  13 72 05 bb 00 70 eb 76  b4 08 cd 13 73 0d 5a 84  |.r...p.v....s.Z.|
000000e0  d2 0f 83 de 00 be 85 7d  e9 82 00 66 0f b6 c6 88  |.......}...f....|
000000f0  64 ff 40 66 89 44 04 0f  b6 d1 c1 e2 02 88 e8 88  |d.@f.D..........|
00000100  f4 40 89 44 08 0f b6 c2  c0 e8 02 66 89 04 66 a1  |.@.D.......f..f.|
00000110  60 7c 66 09 c0 75 4e 66  a1 5c 7c 66 31 d2 66 f7  |`|f..uNf.\|f1.f.|
00000120  34 88 d1 31 d2 66 f7 74  04 3b 44 08 7d 37 fe c1  |4..1.f.t.;D.}7..|
00000130  88 c5 30 c0 c1 e8 02 08  c1 88 d0 5a 88 c6 bb 00  |..0........Z....|
00000140  70 8e c3 31 db b8 01 02  cd 13 72 1e 8c c3 60 1e  |p..1......r...`.|
00000150  b9 00 01 8e db 31 f6 bf  00 80 8e c6 fc f3 a5 1f  |.....1..........|
00000160  61 ff 26 5a 7c be 80 7d  eb 03 be 8f 7d e8 34 00  |a.&Z|..}....}.4.|
00000170  be 94 7d e8 2e 00 cd 18  eb fe 47 52 55 42 20 00  |..}.......GRUB .|
00000180  47 65 6f 6d 00 48 61 72  64 20 44 69 73 6b 00 52  |Geom.Hard Disk.R|
00000190  65 61 64 00 20 45 72 72  6f 72 0d 0a 00 bb 01 00  |ead. Error......|
000001a0  b4 0e cd 10 ac 3c 00 75  f4 c3 00 00 00 00 00 00  |.....<.u........|
000001b0  00 00 00 00 00 00 00 00  2d 9d 03 00 00 00 00 00  |........-.......|
000001c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200

```

显示情况如下：

```
[root@node1 mnt]# fdisk -l /dev/sda 

Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x00039d2d

   Device Boot      Start         End      Blocks   Id  System
[root@node1 mnt]# 

```

```
dd if=dpt of=/dev/sda bs=1 count=64 seek=446
sync

```

救援模式：

```
scp dpt node2/root/dpt
ifconfig ens33 192.168.1.47/24
scp 192.168.1.56/dtp .
dd if=dpt of=/dev/sda bs=1 count=64 seek=446
sync
sync
reboot
```

生成uuid的工具

```
[root@node2 ~]# uuidgen 
4f366129-9e22-4994-8700-be2098fbde08

```

添加一个10G的sdb硬盘；没有分区就什么也没有

```
[root@node1 ~]# hexdump -C -n 512 /dev/sdb
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000200

```

在上面创建gpt

```
[root@node1 ~]# parted /dev/sdb mklabel gpt
Information: You may need to update /etc/fstab.


```

查看分区类型：

```
[root@node1 ~]# hexdump -C -n 512 /dev/sdb
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001c0  01 00 ee fe ff ff 01 00  00 00 ff ff 3f 01 00 00  |............?...|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200
[root@node1 ~]# fdisk -l /dev/sdb
WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: gpt
Disk identifier: A68924ED-E5FF-4538-8CBD-866EADADC511


#         Start          End    Size  Type            Name
[root@node1 ~]# 

```

打印分区表

```
[root@node1 ~]# parted /dev/sdb print
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start  End  Size  File system  Name  Flags


```

开始分区从1M到1000M

```
[root@node1 ~]# parted /dev/sdb mkpart primary 1 1000
Information: You may need to update /etc/fstab.


```

打印分区表

```
[root@node1 ~]# parted /dev/sdb print
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size   File system  Name     Flags
 1      1049kB  1000MB  999MB               primary


```

再次分区：1000-2000

```
[root@node1 ~]# parted /dev/sdb mkpart primary 1000 2000
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted /dev/sdb print                                     
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size   File system  Name     Flags
 1      1049kB  1000MB  999MB               primary
 2      1000MB  2000MB  999MB               primary

[root@node1 ~]# 

```

查看：

```
[root@node1 ~]# lsblk 
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
├─sdb1                  8:17   0  953M  0 part 
└─sdb2                  8:18   0  953M  0 part 
sr0                    11:0    1  8.1G  0 rom  
You have new mail in /var/spool/mail/root
[root@node1 ~]# ls /dev/sdb*
/dev/sdb  /dev/sdb1  /dev/sdb2

```

删除分区1 ：

```
[root@node1 ~]# parted /dev/sdb rm 1
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted /dev/sdb print                                     
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size   File system  Name     Flags
 2      1000MB  2000MB  999MB               primary

[root@node1 ~]# ls /dev/sdb*
/dev/sdb  /dev/sdb2

```

在创建1-3000的分区，因为分区只能连续

```
[root@node1 ~]# parted /dev/sdb mkpart primary 1 3000
Warning: You requested a partition from 1000kB to 3000MB (sectors 1953..5859375).
The closest location we can manage is 1000kB to 1000MB (sectors 1953..1953791).
Is this still acceptable to you?
Yes/No? yes                                                               
Warning: The resulting partition is not properly aligned for best performance.
Ignore/Cancel? I                                                          
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted /dev/sdb print                                     
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size   File system  Name     Flags
 1      1000kB  1000MB  999MB               primary
 2      1000MB  2000MB  999MB               primary

```

删除：

```
[root@node1 ~]# parted  /dev/sdb rm 1
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted  /dev/sdb rm 2
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted /dev/sdb mkpart primary 1 1000
Information: You may need to update /etc/fstab.

[root@node1 ~]# parted /dev/sdb print                     
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start   End     Size   File system  Name     Flags
 1      1049kB  1000MB  999MB               primary


```

删除分区后还是有gpt标志：

```
[root@node1 ~]# parted /dev/sdb rm 1
Information: You may need to update /etc/fstab.

[root@node1 ~]#                                                           
[root@node1 ~]# 
[root@node1 ~]# parted /dev/sdb print
Model: VMware, VMware Virtual S (scsi)
Disk /dev/sdb: 10.7GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags: 

Number  Start  End  Size  File system  Name  Flags

[root@node1 ~]# hexdump -C -n 512 /dev/sdb
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001c0  01 00 ee fe ff ff 01 00  00 00 ff ff 3f 01 00 00  |............?...|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200
[root@node1 ~]# dd if=/dev/zero of=/dev/sdb bs=1 count=2 seek=510
2+0 records in
2+0 records out
2 bytes (2 B) copied, 0.000668695 s, 3.0 kB/s
[root@node1 ~]# hexdump -C -n 512 /dev/sdb
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001c0  01 00 ee fe ff ff 01 00  00 00 ff ff 3f 01 00 00  |............?...|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000200
[root@node1 ~]# fdisk -l /dev/sdb

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

```

创建分区

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xe248ffc4.

Command (m for help): m
Command action
   a   toggle a bootable flag
   b   edit bsd disklabel
   c   toggle the dos compatibility flag
   d   delete a partition
   g   create a new empty GPT partition table
   G   create an IRIX (SGI) partition table
   l   list known partition types
   m   print this menu
   n   add a new partition
   o   create a new empty DOS partition table
   p   print the partition table
   q   quit without saving changes
   s   create a new empty Sun disklabel
   t   change a partition's system id
   u   change display/entry units
   v   verify the partition table
   w   write table to disk and exit
   x   extra functionality (experts only)

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-20971519, default 2048): 
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-20971519, default 20971519): +1000M  
Partition 1 of type Linux and of size 1000 MiB is set

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux


```

添加硬盘不出现使用扫描硬盘的方法

```
[root@node1 ~]# echo '- - -' >  /sys/class/scsi_host/host0/scan 

```

查看fdisk版本：

```
[root@node1 ~]# fdisk -v
fdisk from util-linux 2.23.2

```

创建一个扩展分区

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): n
Partition type:
   p   primary (1 primary, 0 extended, 3 free)
   e   extended
Select (default p): e
Partition number (2-4, default 2): 2
First sector (2050048-20971519, default 2050048): 
Using default value 2050048
Last sector, +sectors or +size{K,M,G} (2050048-20971519, default 20971519): +2000M
Partition 2 of type Extended and of size 2 GiB is set

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended


```

创建逻辑分区：删除5之后，6的分区名称会变成5，逻辑分区设备名不稳定

```
Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended

Command (m for help): n
Partition type:
   p   primary (1 primary, 1 extended, 2 free)
   l   logical (numbered from 5)
Select (default p): l
Adding logical partition 5
First sector (2052096-6146047, default 2052096): 
Using default value 2052096
Last sector, +sectors or +size{K,M,G} (2052096-6146047, default 6146047): +500M
Partition 5 of type Linux and of size 500 MiB is set

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended
/dev/sdb5         2052096     3076095      512000   83  Linux

Command (m for help): n
Partition type:
   p   primary (1 primary, 1 extended, 2 free)
   l   logical (numbered from 5)
Select (default p): l
Adding logical partition 6
First sector (3078144-6146047, default 3078144): 
Using default value 3078144
Last sector, +sectors or +size{K,M,G} (3078144-6146047, default 6146047): +200M
Partition 6 of type Linux and of size 200 MiB is set

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended
/dev/sdb5         2052096     3076095      512000   83  Linux
/dev/sdb6         3078144     3487743      204800   83  Linux

Command (m for help): d
Partition number (1,2,5,6, default 6): 5
Partition 5 is deleted

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended
/dev/sdb5         3078144     3487743      204800   83  Linux

Command (m for help): 

```

如果删除扩展分区，逻辑分区也会被删除

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux
/dev/sdb2         2050048     6146047     2048000    5  Extended
/dev/sdb5         3078144     3487743      204800   83  Linux

Command (m for help): d
Partition number (1,2,5, default 5): 2
Partition 2 is deleted

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   83  Linux

Command (m for help): 

```

## 修改分区id

```
Command (m for help): t
Selected partition 1
Hex code (type L to list all codes): l

 0  Empty           24  NEC DOS         81  Minix / old Lin bf  Solaris        
 1  FAT12           27  Hidden NTFS Win 82  Linux swap / So c1  DRDOS/sec (FAT-
 2  XENIX root      39  Plan 9          83  Linux           c4  DRDOS/sec (FAT-
 3  XENIX usr       3c  PartitionMagic  84  OS/2 hidden C:  c6  DRDOS/sec (FAT-
 4  FAT16 <32M      40  Venix 80286     85  Linux extended  c7  Syrinx         
 5  Extended        41  PPC PReP Boot   86  NTFS volume set da  Non-FS data    
 6  FAT16           42  SFS             87  NTFS volume set db  CP/M / CTOS / .
 7  HPFS/NTFS/exFAT 4d  QNX4.x          88  Linux plaintext de  Dell Utility   
 8  AIX             4e  QNX4.x 2nd part 8e  Linux LVM       df  BootIt         
 9  AIX bootable    4f  QNX4.x 3rd part 93  Amoeba          e1  DOS access     
 a  OS/2 Boot Manag 50  OnTrack DM      94  Amoeba BBT      e3  DOS R/O        
 b  W95 FAT32       51  OnTrack DM6 Aux 9f  BSD/OS          e4  SpeedStor      
 c  W95 FAT32 (LBA) 52  CP/M            a0  IBM Thinkpad hi eb  BeOS fs        
 e  W95 FAT16 (LBA) 53  OnTrack DM6 Aux a5  FreeBSD         ee  GPT            
 f  W95 Ext'd (LBA) 54  OnTrackDM6      a6  OpenBSD         ef  EFI (FAT-12/16/
10  OPUS            55  EZ-Drive        a7  NeXTSTEP        f0  Linux/PA-RISC b
11  Hidden FAT12    56  Golden Bow      a8  Darwin UFS      f1  SpeedStor      
12  Compaq diagnost 5c  Priam Edisk     a9  NetBSD          f4  SpeedStor      
14  Hidden FAT16 <3 61  SpeedStor       ab  Darwin boot     f2  DOS secondary  
16  Hidden FAT16    63  GNU HURD or Sys af  HFS / HFS+      fb  VMware VMFS    
17  Hidden HPFS/NTF 64  Novell Netware  b7  BSDI fs         fc  VMware VMKCORE 
18  AST SmartSleep  65  Novell Netware  b8  BSDI swap       fd  Linux raid auto
1b  Hidden W95 FAT3 70  DiskSecure Mult bb  Boot Wizard hid fe  LANstep        
1c  Hidden W95 FAT3 75  PC/IX           be  Solaris boot    ff  BBT            
1e  Hidden W95 FAT1 80  Old Minix      
Hex code (type L to list all codes): 8e
Changed type of partition 'Linux' to 'Linux LVM'

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     2050047     1024000   8e  Linux LVM

```

如果不保存是看不到分区的

```
[root@node1 ~]# cat /proc/pa
pagetypeinfo  partitions    
[root@node1 ~]# cat /proc/partitions 
major minor  #blocks  name

  11        0    8491008 sr0
   8        0   20971520 sda
   8        1    1048576 sda1
   8        2   19921920 sda2
   8       16   10485760 sdb
   8       17    1024000 sdb1
   8       18          1 sdb2
   8       21     204800 sdb5
 253        0   17821696 dm-0
 253        1    2097152 dm-1
[root@node1 ~]# ls /dev/sdb*
/dev/sdb  /dev/sdb1  /dev/sdb2  /dev/sdb5
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
├─sdb1                  8:17   0 1000M  0 part 
├─sdb2                  8:18   0    1K  0 part 
└─sdb5                  8:21   0  200M  0 part 
sr0                    11:0    1  8.1G  0 rom  

```

centos6 上partprobe 命令不好使，不要使用了，如果有warning 操作如下：

```
[root@node1 ~]# partprobe /dev/sdb
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# partx -a /dev/sdb
partx: /dev/sdb: error adding partition 1
[root@node1 ~]# 
[root@node1 ~]# 
```

删除分区不同步时，

```
[root@node1 ~]# 
[root@node1 ~]# partx -d --nr 1 /dev/sdb
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
sr0                    11:0    1  8.1G  0 rom  

```

centos7 直接使用partprobe 就可以 ：

同步centos6

加分区：partx -a /dev/sdb

删除分区：partx -d --nr 5-7 /dev/sdb

centos5,7 partprobe



centos7以柱面显示分区

```
[root@node1 ~]# fdisk -u=cylinders /dev/sdb

WARNING: cylinders as display units are deprecated. Use command 'u' to
         change units to sectors.
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xe248ffc4

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1         131     1048576   83  Linux
/dev/sdb2             131         392     2097152   83  Linux

Command (m for help): 

```

克隆sda的分区表：因为a=20G，b=10G,克隆的不完整；逻辑分区也不能克隆

```
[root@node1 ~]# dd if=/dev/sda of=/dev/sdb bs=1 count=66 skip=446 seek=446
66+0 records in
66+0 records out
66 bytes (66 B) copied, 0.000652017 s, 101 kB/s
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
├─sdb1                  8:17   0    1G  0 part 
└─sdb2                  8:18   0    9G  0 part 
sr0                    11:0    1  8.1G  0 rom  

```

校验：

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): v
Total allocated sectors 41940993 greater than the maximum 20971520

Command (m for help): 

```

gdisk分区

```
[root@node1 ~]# gdisk /dev/sdb
GPT fdisk (gdisk) version 0.8.6

Partition table scan:
  MBR: not present
  BSD: not present
  APM: not present
  GPT: present

Found valid GPT with corrupt MBR; using GPT and will write new
protective MBR on save.

Command (? for help): ?
b	back up GPT data to a file
c	change a partition's name
d	delete a partition
i	show detailed information on a partition
l	list known partition types
n	add a new partition
o	create a new empty GUID partition table (GPT)
p	print the partition table
q	quit without saving changes
r	recovery and transformation options (experts only)
s	sort partitions
t	change a partition's type code
v	verify disk
w	write table to disk and exit
x	extra functionality (experts only)
?	print this menu

Command (? for help): n
Partition number (1-128, default 1): 1
First sector (34-20971486, default = 2048) or {+-}size{KMGTP}: 
Last sector (2048-20971486, default = 20971486) or {+-}size{KMGTP}: +1G
Current type is 'Linux filesystem'
Hex code or GUID (L to show codes, Enter = 8300): 
Changed type of partition to 'Linux filesystem'

Command (? for help): p
Disk /dev/sdb: 20971520 sectors, 10.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): A68924ED-E5FF-4538-8CBD-866EADADC511
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 20971486
Partitions will be aligned on 2048-sector boundaries
Total free space is 18874301 sectors (9.0 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         2099199   1024.0 MiB  8300  Linux filesystem
Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sdb.
The operation has completed successfully.
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
└─sdb1                  8:17   0    1G  0 part 
sr0                    11:0    1  8.1G  0 rom  


```

```
ex code or GUID (L to show codes, Enter = 8300): 8e00
Changed type of partition to 'Linux LVM'

Command (? for help): p
Disk /dev/sdb: 20971520 sectors, 10.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): A68924ED-E5FF-4538-8CBD-866EADADC511
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 20971486
Partitions will be aligned on 2048-sector boundaries
Total free space is 14679997 sectors (7.0 GiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048         2099199   1024.0 MiB  8E00  Linux LVM
   2         2099200         6293503   2.0 GiB     8E00  Linux LVM

Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sdb.
The operation has completed successfully.

```

dd命令清除分区：

```
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
├─sdb1                  8:17   0    1G  0 part 
└─sdb2                  8:18   0    2G  0 part 
sr0                    11:0    1  8.1G  0 rom  
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# dd if=/dev/zero of=/dev/sdb bs=1 count=66 seek=446
66+0 records in
66+0 records out
66 bytes (66 B) copied, 0.000725471 s, 91.0 kB/s
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
sr0                    11:0    1  8.1G  0 rom  

```

柱面越小的，也是在磁盘外圈，速度越快，柱面越大的磁盘就在内圈速度慢

```
[root@node1 ~]# fdisk -l /dev/sda -u=cylinders

Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
Units = cylinders of 16065 * 512 = 8225280 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x00039d2d

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *           1         131     1048576   83  Linux
/dev/sda2             131        2611    19921920   8e  Linux LVM

```

如果没有创建文件系统，只分区，里面没有内容

```
[root@node1 ~]# 
[root@node1 ~]# hexdump -C -n 1024 /dev/sdb1
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001b0  00 00 00 00 00 00 00 00  00 6b 22 b7 00 00 00 20  |.........k".... |
000001c0  21 00 83 66 25 01 00 08  00 00 00 50 00 00 00 00  |!..f%......P....|
000001d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00000200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000400

```

文件系统：windows有加密功能，ntfs，

查看Linux支持的文件系统

```
[root@node1 ~]# ls -1 /lib/modules/3.10.0-693.el7.x86_64/kernel/fs/
binfmt_misc.ko.xz
btrfs
cachefiles
ceph
cifs
cramfs
dlm
exofs
ext4
fat
fscache
fuse
gfs2
isofs
jbd2
lockd
mbcache.ko.xz
nfs
nfs_common
nfsd
nls
overlayfs
pstore
squashfs
udf
xfs

```

CentOS6 默认的文件系统时ext4，CentOS7是XFS，Ubuntu是ext4

```
[root@node1 ~]# df -T
Filesystem                    Type     1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root xfs       17811456 5200284  12611172  30% /
devtmpfs                      devtmpfs    917604       0    917604   0% /dev
tmpfs                         tmpfs       933524       0    933524   0% /dev/shm
tmpfs                         tmpfs       933524    9248    924276   1% /run
tmpfs                         tmpfs       933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                     xfs        1038336  182340    855996  18% /boot
tmpfs                         tmpfs       186708      36    186672   1% /run/user/1000
/dev/sr0                      iso9660    8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                         tmpfs       186708       0    186708   0% /run/user/0

```

查看是否有ext4文件系统的驱动

```
[root@node1 ~]# locate xfs.ko
/usr/lib/modules/3.10.0-693.el7.x86_64/kernel/fs/xfs/xfs.ko.xz
[root@node1 ~]# locate ext4.ko
/usr/lib/modules/3.10.0-693.el7.x86_64/kernel/fs/ext4/ext4.ko.xz
[root@node1 ~]# 

```

支持的文件系统列表

```
[root@node1 ~]# cat /proc/filesystems 
nodev	sysfs
nodev	rootfs
nodev	ramfs
nodev	bdev
nodev	proc
nodev	cgroup
nodev	cpuset
nodev	tmpfs
nodev	devtmpfs
nodev	debugfs
nodev	securityfs
nodev	sockfs
nodev	pipefs
nodev	anon_inodefs
nodev	configfs
nodev	devpts
nodev	hugetlbfs
nodev	autofs
nodev	pstore
nodev	mqueue
nodev	selinuxfs
	xfs
nodev	rpc_pipefs
nodev	nfsd
	fuseblk
nodev	fuse
nodev	fusectl
	iso9660

```

分区格式化文件系统

```
[root@node1 ~]# mkfs -t xfs /dev/sdb2
meta-data=/dev/sdb2              isize=512    agcount=4, agsize=131072 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=524288, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node1 ~]# mount /dev/sdb2 /mnt
[root@node1 ~]# df -t
df: option requires an argument -- 't'
Try 'df --help' for more information.
[root@node1 ~]# df -T
Filesystem                    Type     1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root xfs       17811456 5200380  12611076  30% /
devtmpfs                      devtmpfs    917604       0    917604   0% /dev
tmpfs                         tmpfs       933524       0    933524   0% /dev/shm
tmpfs                         tmpfs       933524    9252    924272   1% /run
tmpfs                         tmpfs       933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                     xfs        1038336  182340    855996  18% /boot
tmpfs                         tmpfs       186708      40    186668   1% /run/user/1000
/dev/sr0                      iso9660    8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                         tmpfs       186708       0    186708   0% /run/user/0
/dev/sdb2                     xfs        2086912   32944   2053968   2% /mnt
[root@node1 ~]# 

```

```
[root@node1 ~]# mkfs.xfs /dev/sdb3
meta-data=/dev/sdb3              isize=512    agcount=4, agsize=196608 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=786432, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node1 ~]# mkdir /mnt/db3
[root@node1 ~]# mount /dev/sdb3 /mnt/db3
[root@node1 ~]# df -T
Filesystem                    Type     1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root xfs       17811456 5200320  12611136  30% /
devtmpfs                      devtmpfs    917604       0    917604   0% /dev
tmpfs                         tmpfs       933524       0    933524   0% /dev/shm
tmpfs                         tmpfs       933524    9256    924268   1% /run
tmpfs                         tmpfs       933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                     xfs        1038336  182340    855996  18% /boot
tmpfs                         tmpfs       186708      40    186668   1% /run/user/1000
/dev/sr0                      iso9660    8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                         tmpfs       186708       0    186708   0% /run/user/0
/dev/sdb2                     xfs        2086912   32944   2053968   2% /mnt
/dev/sdb3                     xfs        3135488   32944   3102544   2% /mnt/db3

```

创建好的文件系统查看

```
[root@node1 ~]# blkid
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sdb1: UUID="36ce3b96-7ad8-4e4a-bc37-c359e6f5a8f6" TYPE="ext4" 
/dev/sdb2: UUID="968cbe99-5a54-488f-97b1-2005d5e47286" TYPE="xfs" 
/dev/sdb3: UUID="b808a1d6-d445-4f49-953a-dca0c6ba6e89" TYPE="ext4" 
/dev/sr0: UUID="2017-09-06-10-53-42-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 

```

```
[root@node1 ~]# mke2fs -t ext4 /dev/sdb3
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
196608 inodes, 786432 blocks
39321 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=805306368
24 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 

[root@node1 ~]# blkid
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sdb1: UUID="673433d8-52c1-403f-af27-8d55e2d6c25f" SEC_TYPE="ext2" TYPE="ext3" 
/dev/sdb2: UUID="968cbe99-5a54-488f-97b1-2005d5e47286" TYPE="xfs" 
/dev/sdb3: UUID="2c752c16-a53f-434a-ae82-4c7f5a171e68" TYPE="ext4" 
/dev/sr0: UUID="2017-09-06-10-53-42-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 

```

 tune2fs允许系统管理员在Linux ext2、ext3或ext4文件系统上调整各种可调的文件系统参数。这些选项的当前值可以使用-l选项显示，也可以通过使用dumpe2fs (8)程序显示。

```
[root@node1 ~]# tune2fs -l /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   <none>
Last mounted on:          <not available>
Filesystem UUID:          0655e53f-55ce-4853-9232-642560006a02
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              196608
Block count:              786432
Reserved block count:     39321
Free blocks:              755396
Free inodes:              196597
First block:              0
Block size:               4096
Fragment size:            4096
Group descriptor size:    64
Reserved GDT blocks:      383
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Sun Sep 13 12:08:09 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 12:08:09 2020
Mount count:              0
Maximum mount count:      -1
Last checked:             Sun Sep 13 12:08:09 2020
Check interval:           0 (<none>)
Lifetime writes:          66 MB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      94d45743-9bb4-4eb3-b08f-6d84fa7ec742
Journal backup:           inode blocks

```

dumpe2fs 

```
[root@node1 ~]# dumpe2fs /dev/sdb3
dumpe2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   <none>
Last mounted on:          <not available>
Filesystem UUID:          0655e53f-55ce-4853-9232-642560006a02
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              196608
Block count:              786432
Reserved block count:     39321
Free blocks:              755396
Free inodes:              196597
First block:              0
Block size:               4096
Fragment size:            4096
Group descriptor size:    64
Reserved GDT blocks:      383
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Flex block group size:    16
Filesystem created:       Sun Sep 13 12:08:09 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 12:08:09 2020
Mount count:              0
Maximum mount count:      -1
Last checked:             Sun Sep 13 12:08:09 2020
Check interval:           0 (<none>)
Lifetime writes:          66 MB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      94d45743-9bb4-4eb3-b08f-6d84fa7ec742
Journal backup:           inode blocks
Journal features:         (none)
Journal size:             64M
Journal length:           16384
Journal sequence:         0x00000001
Journal start:            0


Group 0: (Blocks 0-32767)

```

重新格式化

```
[root@node1 ~]# mkfs.xfs -f /dev/sdb3
meta-data=/dev/sdb3              isize=512    agcount=4, agsize=196608 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=786432, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

```

挂在查看详细信息

```
[root@node1 ~]# xfs_info /dev/sdb3
xfs_info: /dev/sdb3 is not a mounted XFS filesystem
[root@node1 ~]# 
[root@node1 ~]# mount /dev/sdb3 /mnt/db3
[root@node1 ~]# xfs_info /dev/sdb3
meta-data=/dev/sdb3              isize=512    agcount=4, agsize=196608 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0 spinodes=0
data     =                       bsize=4096   blocks=786432, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node1 ~]# 

```

格式化ext2查看没有has_journal 

```
[root@node1 ~]# mkfs.ext2 -b 1024 -m 0.1 -I 128 -L /mnt/db3 /dev/sdb3
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=/mnt/db3
OS type: Linux
Block size=1024 (log=0)
Fragment size=1024 (log=0)
Stride=0 blocks, Stripe width=0 blocks
196608 inodes, 3145728 blocks
3145 blocks (0.10%) reserved for the super user
First data block=1
Maximum filesystem blocks=70254592
384 block groups
8192 blocks per group, 8192 fragments per group
512 inodes per group
Superblock backups stored on blocks: 
	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409, 663553, 
	1024001, 1990657, 2809857

Allocating group tables: done                            
Writing inode tables: done                            
Writing superblocks and filesystem accounting information: done   

[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# tune2fs -l /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   /mnt/db3
Last mounted on:          <not available>
Filesystem UUID:          ee3d99de-cd24-4160-8a8c-4ccd9acec6b2
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      ext_attr resize_inode dir_index filetype sparse_super
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              196608
Block count:              3145728
Reserved block count:     3145
Free blocks:              3116872
Free inodes:              196597
First block:              1
Block size:               1024
Fragment size:            1024
Reserved GDT blocks:      256
Blocks per group:         8192
Fragments per group:      8192
Inodes per group:         512
Inode blocks per group:   64
Filesystem created:       Sun Sep 13 12:41:34 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 12:41:34 2020
Mount count:              0
Maximum mount count:      -1
Last checked:             Sun Sep 13 12:41:34 2020
Check interval:           0 (<none>)
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          128
Default directory hash:   half_md4
Directory Hash Seed:      1912d7e8-0db4-4565-b5c1-2ea677aeb1f8

```

加入日志功能

```
[root@node1 ~]# tune2fs -O has_journal /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
Creating journal inode: done
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# blkid /dev/sdb3
/dev/sdb3: LABEL="/mnt/db3" UUID="ee3d99de-cd24-4160-8a8c-4ccd9acec6b2" SEC_TYPE="ext2" TYPE="ext3" 
[root@node1 ~]# 

```

加入acl功能

```
[root@node1 ~]# tune2fs -o acl /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)

```

```
[root@node1 ~]# tune2fs -l /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   /mnt/db3
Last mounted on:          <not available>
Filesystem UUID:          ee3d99de-cd24-4160-8a8c-4ccd9acec6b2
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype sparse_super
Filesystem flags:         signed_directory_hash 
Default mount options:    user_xattr acl
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              196608
Block count:              3145728
Reserved block count:     3145
Free blocks:              3083975
Free inodes:              196597
First block:              1
Block size:               1024
Fragment size:            1024
Reserved GDT blocks:      256
Blocks per group:         8192
Fragments per group:      8192
Inodes per group:         512
Inode blocks per group:   64
Filesystem created:       Sun Sep 13 12:41:34 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 12:48:53 2020
Mount count:              0
Maximum mount count:      -1
Last checked:             Sun Sep 13 12:41:34 2020
Check interval:           0 (<none>)
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          128
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      1912d7e8-0db4-4565-b5c1-2ea677aeb1f8
Journal backup:           inode blocks

```

删除acl功能

```
[root@node1 ~]# tune2fs -o ^acl /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
[root@node1 ~]# 

```

查看信息

```
[root@node1 ~]# tune2fs -o ^user_xattr /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
[root@node1 ~]# tune2fs -l /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
Filesystem volume name:   /mnt/db3
Last mounted on:          <not available>
Filesystem UUID:          ee3d99de-cd24-4160-8a8c-4ccd9acec6b2
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype sparse_super
Filesystem flags:         signed_directory_hash 
Default mount options:    (none)
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              196608
Block count:              3145728
Reserved block count:     3145
Free blocks:              3083975
Free inodes:              196597
First block:              1
Block size:               1024
Fragment size:            1024
Reserved GDT blocks:      256
Blocks per group:         8192
Fragments per group:      8192
Inodes per group:         512
Inode blocks per group:   64
Filesystem created:       Sun Sep 13 12:41:34 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 12:50:59 2020
Mount count:              0
Maximum mount count:      -1
Last checked:             Sun Sep 13 12:41:34 2020
Check interval:           0 (<none>)
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          128
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      1912d7e8-0db4-4565-b5c1-2ea677aeb1f8
Journal backup:           inode blocks

```

CentOS6 自动安装系统分区有acl，自己创建的没有acl功能，7都有acl

根据uuid或者标签查找分区

```
[root@node1 ~]# blkid
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sdb1: UUID="673433d8-52c1-403f-af27-8d55e2d6c25f" SEC_TYPE="ext2" TYPE="ext3" 
/dev/sdb2: UUID="968cbe99-5a54-488f-97b1-2005d5e47286" TYPE="xfs" 
/dev/sdb3: LABEL="/mnt/db3" UUID="ee3d99de-cd24-4160-8a8c-4ccd9acec6b2" SEC_TYPE="ext2" TYPE="ext3" 
/dev/sr0: UUID="2017-09-06-10-53-42-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
[root@node1 ~]# bliid -U ee3d99de-cd24-4160-8a8c-4ccd9acec6b2
bash: bliid: command not found...
[root@node1 ~]# blkid -U ee3d99de-cd24-4160-8a8c-4ccd9acec6b2
/dev/sdb3
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# blkid -L /mnt/db3
/dev/sdb3

```

添加卷标

```
[root@node1 ~]# e2label /dev/sdb2

[root@node1 ~]# e2label /dev/sdb2 /mnt/sdb2
[root@node1 ~]# e2label /dev/sdb2
/mnt/sdb2

```

修改uuid

```
[root@node1 ~]# uuidgen 
46ce7f8f-eea1-4845-abe5-f322a313e536
[root@node1 ~]# tune2fs -U 46ce7f8f-eea1-4845-abe5-f322a313e536 /dev/sdb3
tune2fs 1.42.9 (28-Dec-2013)
[root@node1 ~]# blkid /dev/sdb3
/dev/sdb3: LABEL="/mnt/db3" UUID="46ce7f8f-eea1-4845-abe5-f322a313e536" SEC_TYPE="ext2" TYPE="ext3" 

```

文件系统检查和修复模拟，ext4

```
[root@node1 ~]# mount /dev/sdb3 /mnt/sdb3
[root@node1 ~]# cp -r /usr/* /mnt/sdb3
^C
[root@node1 ~]# du -sh /mnt/sdb3
253M	/mnt/sdb3
[root@node1 ~]# cd /mnt/sdb3
[root@node1 sdb3]# du -sh .
253M	.
[root@node1 sdb3]# cd -
/root
[root@node1 ~]# df -T
Filesystem                    Type     1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root xfs       17811456 5200600  12610856  30% /
devtmpfs                      devtmpfs    917604       0    917604   0% /dev
tmpfs                         tmpfs       933524       0    933524   0% /dev/shm
tmpfs                         tmpfs       933524    9264    924260   1% /run
tmpfs                         tmpfs       933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                     xfs        1038336  182340    855996  18% /boot
tmpfs                         tmpfs       186708      40    186668   1% /run/user/1000
/dev/sr0                      iso9660    8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                         tmpfs       186708       0    186708   0% /run/user/0
/dev/sdb3                     ext3       3087446  260045   2824256   9% /mnt/sdb3
[root@node1 ~]# df -H
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   19G  5.4G   13G  30% /
devtmpfs                       940M     0  940M   0% /dev
tmpfs                          956M     0  956M   0% /dev/shm
tmpfs                          956M  9.5M  947M   1% /run
tmpfs                          956M     0  956M   0% /sys/fs/cgroup
/dev/sda1                      1.1G  187M  877M  18% /boot
tmpfs                          192M   41k  192M   1% /run/user/1000
/dev/sr0                       8.7G  8.7G     0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                          192M     0  192M   0% /run/user/0
/dev/sdb3                      3.2G  267M  2.9G   9% /mnt/sdb3

```

文件系统已经损坏

```
[root@node1 ~]# dd if=/dev/zero of=/dev/sdb3 bs=1M count=1
1+0 records in
1+0 records out
1048576 bytes (1.0 MB) copied, 0.00681102 s, 154 MB/s
[root@node1 ~]# umount /dev/sdb3
[root@node1 ~]# mount /dev/sdb3 /mnt/sdb3
mount: /dev/sdb3 is write-protected, mounting read-only
mount: wrong fs type, bad option, bad superblock on /dev/sdb3,
       missing codepage or helper program, or other error

       In some cases useful info is found in syslog - try
       dmesg | tail or so.
[root@node1 ~]# 

```

开始修复，修复之前，文件系统时不能挂载的

```
[root@node1 ~]# fsck -y /dev/sdb3
fsck from util-linux 2.23.2
e2fsck 1.42.9 (28-Dec-2013)
ext2fs_open2: Bad magic number in super-block
fsck.ext2: Superblock invalid, trying backup blocks...
/mnt/db3 was not cleanly unmounted, check forced.
Resize inode not valid.  Recreate? yes

Pass 1: Checking inodes, blocks, and sizes
Root inode is not a directory.  Clear? yes

Inode 8, i_blocks is 0, should be 65794.  Fix? yes

Extended attribute block 229443 has reference count 803, should be 802.  Fix? yes

Pass 2: Checking directory structure
Entry '..' in <2>/<20481> (20481) has deleted/unused inode 2.  Clear? yes

Entry '..' in <2>/<49153> (49153) has deleted/unused inode 2.  Clear? yes

Entry '..' in <2>/<99329> (99329) has deleted/unused inode 2.  Clear? yes

Entry '..' in <2>/<143361> (143361) has deleted/unused inode 2.  Clear? yes

Pass 3: Checking directory connectivity
Root inode not allocated.  Allocate? yes

Unconnected directory inode 20481 (...)
Connect to /lost+found? yes

/lost+found not found.  Create? yes


```

检查：

```
[root@node1 ~]# mount /dev/sdb3 /mnt/sdb3
[root@node1 ~]# cd /mnt/sdb3
[root@node1 sdb3]# ls
bin  etc  games  include  lib  lost+found
[root@node1 sdb3]# 
[root@node1 sdb3]# 
[root@node1 sdb3]# 
[root@node1 sdb3]# du -sh .
478M	.

```

挂载：只读

```
[root@node1 ~]# mount -r /dev/sdb3 /mnt/sdb3
[root@node1 ~]# mount 
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
devtmpfs on /dev type devtmpfs (rw,nosuid,seclabel,size=917604k,nr_inodes=229401,mode=755)
securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,seclabel)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000)
tmpfs on /run type tmpfs (rw,nosuid,nodev,seclabel,mode=755)
tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,seclabel,mode=755)
cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)
configfs on /sys/kernel/config type configfs (rw,relatime)
/dev/mapper/centos_node1-root on / type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
selinuxfs on /sys/fs/selinux type selinuxfs (rw,relatime)
systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=24,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=12990)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,seclabel)
mqueue on /dev/mqueue type mqueue (rw,relatime,seclabel)
nfsd on /proc/fs/nfsd type nfsd (rw,relatime)
/dev/sda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
tmpfs on /run/user/1000 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700,uid=1000,gid=1000)
gvfsd-fuse on /run/user/1000/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,relatime,user_id=1000,group_id=1000)
fusectl on /sys/fs/fuse/connections type fusectl (rw,relatime)
/dev/sr0 on /run/media/shaoxh/CentOS 7 x86_64 type iso9660 (ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8,mode=0400,dmode=0500,uhelper=udisks2)
tmpfs on /run/user/0 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700)
/dev/sdb3 on /mnt/sdb3 type ext4 (ro,relatime,seclabel,data=ordered)
[root@node1 ~]# cd /mnt/sdb3
[root@node1 sdb3]# touch f1
touch: cannot touch ‘f1’: Read-only file system

```

重新挂载：

```
[root@node1 sdb3]# mount -o remount,rw /dev/sdb3 /mnt/sdb3
[root@node1 sdb3]# mount 
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
devtmpfs on /dev type devtmpfs (rw,nosuid,seclabel,size=917604k,nr_inodes=229401,mode=755)
securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,seclabel)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000)
tmpfs on /run type tmpfs (rw,nosuid,nodev,seclabel,mode=755)
tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,seclabel,mode=755)
cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)
configfs on /sys/kernel/config type configfs (rw,relatime)
/dev/mapper/centos_node1-root on / type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
selinuxfs on /sys/fs/selinux type selinuxfs (rw,relatime)
systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=24,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=12990)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,seclabel)
mqueue on /dev/mqueue type mqueue (rw,relatime,seclabel)
nfsd on /proc/fs/nfsd type nfsd (rw,relatime)
/dev/sda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
tmpfs on /run/user/1000 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700,uid=1000,gid=1000)
gvfsd-fuse on /run/user/1000/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,relatime,user_id=1000,group_id=1000)
fusectl on /sys/fs/fuse/connections type fusectl (rw,relatime)
/dev/sr0 on /run/media/shaoxh/CentOS 7 x86_64 type iso9660 (ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8,mode=0400,dmode=0500,uhelper=udisks2)
tmpfs on /run/user/0 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700)
/dev/sdb3 on /mnt/sdb3 type ext4 (rw,relatime,seclabel,data=ordered)
[root@node1 sdb3]# touch f1
[root@node1 sdb3]# ls
bin  etc  f1  games  include  lib  lost+found

```

卸载：

```
[root@node1 ~]# umount /boot
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5200864  12610592  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9264    924260   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sdb3                       3030800  498540   2358592  18% /mnt/sdb3
[root@node1 ~]# mount -a
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5200844  12610612  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9264    924260   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sdb3                       3030800  498540   2358592  18% /mnt/sdb3
/dev/sda1                       1038336  182340    855996  18% /boot
[root@node1 ~]# 

```

显示当前挂载的情况：

```
[root@node1 ~]# cat /etc/mtab 
rootfs / rootfs rw 0 0
sysfs /sys sysfs rw,seclabel,nosuid,nodev,noexec,relatime 0 0
proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
devtmpfs /dev devtmpfs rw,seclabel,nosuid,size=917604k,nr_inodes=229401,mode=755 0 0
securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
tmpfs /dev/shm tmpfs rw,seclabel,nosuid,nodev 0 0
devpts /dev/pts devpts rw,seclabel,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
tmpfs /run tmpfs rw,seclabel,nosuid,nodev,mode=755 0 0
tmpfs /sys/fs/cgroup tmpfs ro,seclabel,nosuid,nodev,noexec,mode=755 0 0
cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd 0 0
pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime 0 0
cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_prio,net_cls 0 0
cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0
cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0
cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpuacct,cpu 0 0
cgroup /sys/fs/cgroup/blkio cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0
cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0
cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0
cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0
cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0
cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0
configfs /sys/kernel/config configfs rw,relatime 0 0
/dev/mapper/centos_node1-root / xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0
systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=24,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=12990 0 0
debugfs /sys/kernel/debug debugfs rw,relatime 0 0
hugetlbfs /dev/hugepages hugetlbfs rw,seclabel,relatime 0 0
mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
nfsd /proc/fs/nfsd nfsd rw,relatime 0 0
sunrpc /var/lib/nfs/rpc_pipefs rpc_pipefs rw,relatime 0 0
tmpfs /run/user/1000 tmpfs rw,seclabel,nosuid,nodev,relatime,size=186708k,mode=700,uid=1000,gid=1000 0 0
gvfsd-fuse /run/user/1000/gvfs fuse.gvfsd-fuse rw,nosuid,nodev,relatime,user_id=1000,group_id=1000 0 0
fusectl /sys/fs/fuse/connections fusectl rw,relatime 0 0
/dev/sr0 /run/media/shaoxh/CentOS\0407\040x86_64 iso9660 ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8,mode=0400,dmode=0500 0 0
tmpfs /run/user/0 tmpfs rw,seclabel,nosuid,nodev,relatime,size=186708k,mode=700 0 0
/dev/sdb3 /mnt/sdb3 ext4 rw,seclabel,relatime,data=ordered 0 0
/dev/sda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0

```

配置文件会根据mount命令实时同步

```
[root@node1 ~]# umount /dev/sdb3
[root@node1 ~]# cat /etc/mtab 
rootfs / rootfs rw 0 0
sysfs /sys sysfs rw,seclabel,nosuid,nodev,noexec,relatime 0 0
proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
devtmpfs /dev devtmpfs rw,seclabel,nosuid,size=917604k,nr_inodes=229401,mode=755 0 0
securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
tmpfs /dev/shm tmpfs rw,seclabel,nosuid,nodev 0 0
devpts /dev/pts devpts rw,seclabel,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
tmpfs /run tmpfs rw,seclabel,nosuid,nodev,mode=755 0 0
tmpfs /sys/fs/cgroup tmpfs ro,seclabel,nosuid,nodev,noexec,mode=755 0 0
cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd 0 0
pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime 0 0
cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_prio,net_cls 0 0
cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0
cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0
cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpuacct,cpu 0 0
cgroup /sys/fs/cgroup/blkio cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0
cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0
cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0
cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0
cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0
cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0
configfs /sys/kernel/config configfs rw,relatime 0 0
/dev/mapper/centos_node1-root / xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0
selinuxfs /sys/fs/selinux selinuxfs rw,relatime 0 0
systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=24,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=12990 0 0
debugfs /sys/kernel/debug debugfs rw,relatime 0 0
hugetlbfs /dev/hugepages hugetlbfs rw,seclabel,relatime 0 0
mqueue /dev/mqueue mqueue rw,seclabel,relatime 0 0
nfsd /proc/fs/nfsd nfsd rw,relatime 0 0
sunrpc /var/lib/nfs/rpc_pipefs rpc_pipefs rw,relatime 0 0
tmpfs /run/user/1000 tmpfs rw,seclabel,nosuid,nodev,relatime,size=186708k,mode=700,uid=1000,gid=1000 0 0
gvfsd-fuse /run/user/1000/gvfs fuse.gvfsd-fuse rw,nosuid,nodev,relatime,user_id=1000,group_id=1000 0 0
fusectl /sys/fs/fuse/connections fusectl rw,relatime 0 0
/dev/sr0 /run/media/shaoxh/CentOS\0407\040x86_64 iso9660 ro,nosuid,nodev,relatime,uid=1000,gid=1000,iocharset=utf8,mode=0400,dmode=0500 0 0
tmpfs /run/user/0 tmpfs rw,seclabel,nosuid,nodev,relatime,size=186708k,mode=700 0 0
/dev/sda1 /boot xfs rw,seclabel,relatime,attr2,inode64,noquota 0 0

```

```
[root@node1 ~]# ll /etc/mtab 
lrwxrwxrwx. 1 root root 17 Aug 27 20:50 /etc/mtab -> /proc/self/mounts
[root@node1 ~]# 

```

添加卷标，用卷标挂载

```
[root@node1 ~]# mount /dev/sdb3 /mnt/sdb3
[root@node1 ~]# e2label /dev/sdb3

[root@node1 ~]# e2label /dev/sdb3 /mnt/sdb3
[root@node1 ~]# blkid
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sdb1: UUID="673433d8-52c1-403f-af27-8d55e2d6c25f" SEC_TYPE="ext2" TYPE="ext3" 
/dev/sdb2: LABEL="/mnt/sdb2" UUID="229de057-cba4-4265-91fa-693ed399727b" TYPE="ext4" 
/dev/sdb3: LABEL="/mnt/sdb3" UUID="89c54631-a939-4bcd-8526-74c4f9cde948" TYPE="ext4" 
/dev/sr0: UUID="2017-09-06-10-53-42-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# umount /dev/sdb3
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5200820  12610636  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9264    924260   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sda1                       1038336  182340    855996  18% /boot
[root@node1 ~]# mount -L /mnt/sdb3 /mnt/sdb3
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5200820  12610636  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9264    924260   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sda1                       1038336  182340    855996  18% /boot
/dev/sdb3                       3030800  498540   2358592  18% /mnt/sdb3

```

使用uuid挂载

```
[root@node1 ~]# mount -U 89c54631-a939-4bcd-8526-74c4f9cde948 /mnt/sdb3
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5200820  12610636  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9264    924260   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sda1                       1038336  182340    855996  18% /boot
/dev/sdb3                       3030800  498540   2358592  18% /mnt/sdb3

```

一个设备可以有多个挂载点，内容相同

```
[root@node1 ~]# mkdir /mnt/dir1
[root@node1 ~]# mkdir /mnt/dir2
[root@node1 ~]# mount /dev/sdb3 /mnt/dir1
[root@node1 ~]# mount /dev/sdb3 /mnt/dir2
[root@node1 ~]# touch /mnt/dir1/shaoheng
[root@node1 ~]# ls /mnt/dir2/
bin  etc  f1  games  include  lib  lost+found  shaoheng

```

文件夹挂载文件夹

```

[root@node1 /]# mkdir /mnt/boot

[root@node1 /]# mount -B /boot/ /mnt/boot/

[root@node1 /]# cd /mnt/boot/
[root@node1 boot]# ll
total 141064
-rw-r--r--. 1 root root   140894 Aug 23  2017 config-3.10.0-693.el7.x86_64
drwxr-xr-x. 3 root root       17 Aug 27 20:51 efi
drwxr-xr-x. 2 root root       27 Aug 27 20:54 grub
drwx------. 5 root root       97 Aug 27 21:23 grub2
-rw-------. 1 root root 69238010 Aug 27 21:17 initramfs-0-rescue-29e8a05568c6400597169e022e893a92.img
-rw-------. 1 root root 30793842 Aug 27 21:23 initramfs-3.10.0-693.el7.x86_64.img
-rw-------. 1 root root 18798847 Aug 27 21:29 initramfs-3.10.0-693.el7.x86_64kdump.img
-rw-r--r--. 1 root root 10182722 Aug 27 21:09 initrd-plymouth.img
-rw-r--r--. 1 root root   293027 Aug 23  2017 symvers-3.10.0-693.el7.x86_64.gz
-rw-------. 1 root root  3228420 Aug 23  2017 System.map-3.10.0-693.el7.x86_64
-rwxr-xr-x. 1 root root  5877760 Aug 27 21:17 vmlinuz-0-rescue-29e8a05568c6400597169e022e893a92
-rwxr-xr-x. 1 root root  5877760 Aug 23  2017 vmlinuz-3.10.0-693.el7.x86_64
[root@node1 boot]# 

```

文件格式挂载

```
[root@node1 ~]# dd if=/dev/zero of=/data/disk bs=1M count=100
100+0 records in
100+0 records out
104857600 bytes (105 MB) copied, 0.377699 s, 278 MB/s
[root@node1 ~]# ll /data/disk 
-rw-r--r--. 1 root root 104857600 Sep 13 14:51 /data/disk
[root@node1 ~]# mkfs.xfs /data/disk 
meta-data=/data/disk             isize=512    agcount=4, agsize=6400 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=25600, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=855, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node1 ~]# blkid 
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sdb1: UUID="673433d8-52c1-403f-af27-8d55e2d6c25f" SEC_TYPE="ext2" TYPE="ext3" 
/dev/sdb2: LABEL="/mnt/sdb2" UUID="229de057-cba4-4265-91fa-693ed399727b" TYPE="ext4" 
/dev/sdb3: LABEL="/mnt/sdb3" UUID="89c54631-a939-4bcd-8526-74c4f9cde948" TYPE="ext4" 
/dev/sr0: UUID="2017-09-06-10-53-42-00" LABEL="CentOS 7 x86_64" TYPE="iso9660" PTTYPE="dos" 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
[root@node1 ~]# blkid /data/disk
/data/disk: UUID="035c5f2c-601e-4f9e-b268-c83239680dd5" TYPE="xfs" 
[root@node1 ~]# mkdir /mnt/disk; mount /data/disk /mnt/disk
[root@node1 ~]# ls /mnt/disk/
[root@node1 ~]# touch /mnt/disk/f1.txt

```

显示loop挂载

```
[root@node1 disk]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5303232  12508224  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9268    924256   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
tmpfs                            186708      40    186668   1% /run/user/1000
/dev/sr0                        8490330 8490330         0 100% /run/media/shaoxh/CentOS 7 x86_64
tmpfs                            186708       0    186708   0% /run/user/0
/dev/sda1                       1038336  182340    855996  18% /boot
/dev/sdb3                       3030800  498540   2358592  18% /mnt/sdb3
/dev/loop0                        98980    5296     93684   6% /mnt/disk
[root@node1 disk]# losetup -a
/dev/loop0: [64768]:37217810 (/data/disk)
[root@node1 disk]# ls /dev/loop*
/dev/loop0  /dev/loop-control
[root@node1 disk]# 

```

创建设备

```
[root@node1 disk]# mknod /dev/loop100 b 7 100
[root@node1 disk]# ll
total 0
-rw-r--r--. 1 root root 0 Sep 13 14:53 f1.txt
[root@node1 disk]# ll /dev/loop*
brw-rw----. 1 root disk  7,   0 Sep 13 14:52 /dev/loop0
brw-r--r--. 1 root root  7, 100 Sep 13 14:59 /dev/loop100
crw-rw----. 1 root disk 10, 237 Sep 13 14:52 /dev/loop-control
[root@node1 disk]# 

```

centos6修改内核文件：

 在内核一行中加入max_loop=100   重启

挂载设置关联关系

```
[root@node1 ~]# mknod /dev/loop100 b 7 100
[root@node1 ~]# losetup -a 
[root@node1 ~]# losetup /dev/loop100 /data/disk 
[root@node1 ~]# losetup -a
/dev/loop100: [64768]:37217810 (/data/disk)
[root@node1 ~]# mount /dev/loop100 /mnt/disk
[root@node1 ~]# df 
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 5303224  12508232  30% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9232    924292   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                       1038336  182340    855996  18% /boot
tmpfs                            186708       8    186700   1% /run/user/42
tmpfs                            186708       0    186708   0% /run/user/0
/dev/loop100                      98980    6788     92192   7% /mnt/disk

```

拷贝数据：

```
[root@node1 disk]# cp /etc/* /mnt/disk/

```

卸载：

```
[root@node1 ~]# umount /mnt/disk/
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  5.1G   12G  30% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M  8.0K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
[root@node1 ~]# 

```

远程传输：

```
[root@node1 ~]# scp /data/disk 192.168.1.56:/root
root@192.168.1.56's password: 
disk                                                                                                                                                                            100%  100MB  72.3MB/s   00:01    
[root@node1 ~]# 

```

挂载并且显示内容：

```
[root@node2 ~]# mount disk /mnt/
[root@node2 ~]# df -h
Filesystem               Size  Used Avail Use% Mounted on
/dev/mapper/centos-root   17G  4.6G   13G  27% /
devtmpfs                 897M     0  897M   0% /dev
tmpfs                    912M     0  912M   0% /dev/shm
tmpfs                    912M  9.1M  903M   1% /run
tmpfs                    912M     0  912M   0% /sys/fs/cgroup
/dev/sda1               1014M  179M  836M  18% /boot
tmpfs                    183M   12K  183M   1% /run/user/42
tmpfs                    183M     0  183M   0% /run/user/0
/dev/loop0                97M  6.7M   91M   7% /mnt       
```

CentOS6 创建的分区不能直接使用acl功能

```
 [root@bogon ~]# mkfs.ext3 /dev/sdb1 
mke2fs 1.41.12 (17-May-2010)
/dev/sdb1 is mounted; will not make a filesystem here!
[root@bogon ~]# mount 
/dev/mapper/VolGroup-lv_root on / type ext4 (rw)
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
devpts on /dev/pts type devpts (rw,gid=5,mode=620)
tmpfs on /dev/shm type tmpfs (rw,rootcontext="system_u:object_r:tmpfs_t:s0")
/dev/sda1 on /boot type ext4 (rw)
none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)
/dev/sdb1 on /mnt type ext4 (rw)
[root@bogon ~]# umount /mnt/
[root@bogon ~]# mkfs.ext3 /dev/sdb1
mke2fs 1.41.12 (17-May-2010)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
1310720 inodes, 5241592 blocks
262079 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=4294967296
160 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000

Writing inode tables: done                            
Creating journal (32768 blocks): done

```

```
[root@bogon ~]# tune2fs /dev/sdb1 -l
tune2fs 1.41.12 (17-May-2010)
Filesystem volume name:   <none>
Last mounted on:          <not available>
Filesystem UUID:          a3268619-6890-48a9-bb4a-105d3731e0b0
Filesystem magic number:  0xEF53
Filesystem revision #:    1 (dynamic)
Filesystem features:      has_journal ext_attr resize_inode dir_index filetype sparse_super large_file
Filesystem flags:         signed_directory_hash 
Default mount options:    (none)
Filesystem state:         clean
Errors behavior:          Continue
Filesystem OS type:       Linux
Inode count:              1310720
Block count:              5241592
Reserved block count:     262079
Free blocks:              5115270
Free inodes:              1310709
First block:              0
Block size:               4096
Fragment size:            4096
Reserved GDT blocks:      1022
Blocks per group:         32768
Fragments per group:      32768
Inodes per group:         8192
Inode blocks per group:   512
Filesystem created:       Sun Sep 13 20:33:56 2020
Last mount time:          n/a
Last write time:          Sun Sep 13 20:33:57 2020
Mount count:              0
Maximum mount count:      23
Last checked:             Sun Sep 13 20:33:56 2020
Check interval:           15552000 (6 months)
Next check after:         Fri Mar 12 20:33:56 2021
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:	          256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
Default directory hash:   half_md4
Directory Hash Seed:      450d1a73-5ece-46a9-b86e-7c28504798b7
Journal backup:           inode blocks
[root@bogon ~]# mount /dev/sdb1 /mnt
[root@bogon ~]# cp /etc/issue /mnt/
[root@bogon ~]# cd /mnt/
[root@bogon mnt]# ls
issue  lost+found
[root@bogon mnt]# 
[root@bogon mnt]# ll
total 20
-rw-r--r--. 1 root root    47 Sep 13 20:34 issue
drwx------. 2 root root 16384 Sep 13 20:33 lost+found
[root@bogon mnt]# setfacl -m u:wang:rwx issue 
setfacl: issue: Operation not supported
[root@bogon mnt]# 

```

重新挂载：

```
[root@bogon mnt]# mount -o remount,acl /mnt
[root@bogon mnt]# mount 
/dev/mapper/VolGroup-lv_root on / type ext4 (rw)
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
devpts on /dev/pts type devpts (rw,gid=5,mode=620)
tmpfs on /dev/shm type tmpfs (rw,rootcontext="system_u:object_r:tmpfs_t:s0")
/dev/sda1 on /boot type ext4 (rw)
none on /proc/sys/fs/binfmt_misc type binfmt_misc (rw)
/dev/sdb1 on /mnt type ext3 (rw,acl,acl)

```

设置facl

```
[root@bogon mnt]# setfacl -m u:wang:rwx issue 
[root@bogon mnt]# getfacl issue 
# file: issue
# owner: root
# group: root
user::rw-
user:wang:rwx
group::r--
mask::rwx
other::r--

[root@bogon mnt]# 

```

不支持acl

```
[root@bogon mnt]# 
[root@bogon mnt]# mount -o remount,noacl /mnt
[root@bogon mnt]# setfacl -m u:wang:r issue 
setfacl: issue: Operation not supported
[root@bogon mnt]# 

```

如果其他进程使用mount目录

```
[root@bogon mnt]# fuser -v /mnt
                     USER        PID ACCESS COMMAND
/mnt:                root       4247 ..c.. bash
                     root       4282 ..c.. bash
[root@bogon mnt]# 
[root@bogon mnt]# 
[root@bogon mnt]# cd 
[root@bogon ~]# fuser -v /mnt
                     USER        PID ACCESS COMMAND
/mnt:                root       4282 ..c.. bash
[root@bogon ~]# fuser -km /mnt
/mnt:                 4282c

```

findmnt判断是否挂载点

```
[root@bogon ~]# findmnt /mnt
TARGET SOURCE    FSTYPE OPTIONS
/mnt   /dev/sdb1 ext3   rw,relatime,seclabel,errors=continue,barrier=1,data=ordered
[root@bogon ~]# umount /mnt
[root@bogon ~]# findmnt /mnt
[root@bogon ~]# echo $?
1
[root@bogon ~]# 

```

lsof查看使用的的进程

```
[root@bogon ~]# lsof /boot
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
bash    4359 root  cwd    DIR    8,1     1024    2 /boot
[root@bogon ~]# cd /mnt
[root@bogon mnt]# lsof /mnt
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF   NODE NAME
bash    4329 root  cwd    DIR  253,0     4096 392452 /mnt
lsof    4382 root  cwd    DIR  253,0     4096 392452 /mnt
lsof    4383 root  cwd    DIR  253,0     4096 392452 /mnt

```

查看文件来自哪个包

```
[root@bogon mnt]# rpm -qf /etc/fstab
setup-2.8.14-20.el6_4.1.noarch
[root@bogon mnt]# 

```

```
[root@bogon mnt]# rpm -ql setup
/etc/aliases
/etc/bashrc
/etc/csh.cshrc
/etc/csh.login
/etc/environment
/etc/exports
/etc/filesystems
/etc/fstab
/etc/group
/etc/gshadow
/etc/host.conf
/etc/hosts
/etc/hosts.allow
/etc/hosts.deny
/etc/inputrc
/etc/motd
/etc/mtab
/etc/passwd
/etc/printcap
/etc/profile
/etc/profile.d
/etc/protocols
/etc/securetty
/etc/services
/etc/shadow
/etc/shells
/usr/share/doc/setup-2.8.14
/usr/share/doc/setup-2.8.14/COPYING
/usr/share/doc/setup-2.8.14/uidgid
/var/log/lastlog

```

CentOS6中如果配置自动挂载文件错误时，

/etc/fstab  最后两位  备份  检查

```
[root@bogon ~]# cat /etc/fstab 

#
# /etc/fstab
# Created by anaconda on Sun Sep 13 15:27:34 2020
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/VolGroup-lv_root /                       ext4    defaults        1 1
UUID=f7e8f3f2-854f-4a88-a093-ccba35d02987 /boot                   ext4    defaults        1 2
/dev/mapper/VolGroup-lv_swap swap                    swap    defaults        0 0
tmpfs                   /dev/shm                tmpfs   defaults        0 0
devpts                  /dev/pts                devpts  gid=5,mode=620  0 0
sysfs                   /sys                    sysfs   defaults        0 0
proc                    /proc                   proc    defaults        0 0
UUID=a3268619-6890-48a9-bb4a-105d3731e0b3  /mnt ext4 acl 0 0

```

uuid错误的

```
[root@bogon ~]# blkid
/dev/sda1: UUID="f7e8f3f2-854f-4a88-a093-ccba35d02987" TYPE="ext4" 
/dev/sda2: UUID="re8CrQ-YVhy-8tdG-AZV3-ZdTS-raef-HaYGI5" TYPE="LVM2_member" 
/dev/sdb1: UUID="a3268619-6890-48a9-bb4a-105d3731e0b0" TYPE="ext3" LABEL="shaoheng" SEC_TYPE="ext2" 
/dev/mapper/VolGroup-lv_root: UUID="e2e65868-c403-46ea-88a0-0a22d178bbe8" TYPE="ext4" 
/dev/mapper/VolGroup-lv_swap: UUID="ae0f107d-5a4d-4d04-bfde-2c0642247dd2" TYPE="swap" 

```

导致系启动后起不来，解决办法

```
mount -o remount,rw /
修改uuid
修改检查次数0
reboot

```

CnetOS 7配置自动挂载

等待1分30秒后直接输入密码，修改fstab 文件 重启即可

swap分区的创建

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf4d4eafc

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4196351     2097152   82  Linux swap / Solaris

Command (m for help): 
Command (m for help): 
Command (m for help): 
Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# lsblk 
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
└─sdb1                  8:17   0    2G  0 part 
sr0                    11:0    1  8.1G  0 rom  
[root@node1 ~]# mkswap /dev/sdb1
Setting up swapspace version 1, size = 2097148 KiB
no label, UUID=eebdded1-7050-4540-acd3-56e9f75e2e55
[root@node1 ~]# blkid /dev/sdb1
/dev/sdb1: UUID="eebdded1-7050-4540-acd3-56e9f75e2e55" TYPE="swap" 

```

```
[root@node1 ~]# fdisk -l /dev/sdb

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf4d4eafc

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048     4196351     2097152   82  Linux swap / Solaris
[root@node1 ~]# echo 2048*512 |bc
1048576
[root@node1 ~]# hexdump -C -n 1049576 /dev/sdb

```

挂载swap分区

```
[root@node1 ~]# cat /etc/fstab 

#
# /etc/fstab
# Created by anaconda on Thu Aug 27 20:50:19 2020
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/centos_node1-root /                       xfs     defaults        0 0
UUID=f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa /boot                   xfs     defaults        0 0
/dev/mapper/centos_node1-swap swap                    swap    defaults        0 0
UUID="def76c0e-9674-420b-8057-5e914ffd1018"  /mnt      xfs    defaults   0 0 
UUID="eebdded1-7050-4540-acd3-56e9f75e2e55"  swap         swap    defaults  0  0

[root@node1 ~]# cat /proc/swaps 
Filename				Type		Size	Used	Priority
/dev/dm-1                               partition	2097148	0	-1
[root@node1 ~]# swapon -a
[root@node1 ~]# cat /proc/swaps 
Filename				Type		Size	Used	Priority
/dev/dm-1                               partition	2097148	0	-1
/dev/sdb1                               partition	2097148	0	-2

```

查看swap大小

```
[root@node1 ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.8G        292M        1.1G        9.1M        447M        1.3G
Swap:          4.0G          0B        4.0G
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# swapon -s 
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	0	-1
/dev/sdb1                              	partition	2097148	0	-2

```

如何定义sdb1优先使用，调整优先级

```
UUID="eebdded1-7050-4540-acd3-56e9f75e2e55"  swap         swap   pri=10  0  0

```

先关闭swapoff  sdb1

```
[root@node1 ~]# swapoff /dev/sdb1
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	201896	-1
[root@node1 ~]# 

```

在开启swapon

```
[root@node1 ~]# swapon -a
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	201860	-1
/dev/sdb1                              	partition	2097148	0	10

```

测试使用swap

```
[root@node1 ~]# dd if=/dev/zero of=/dev/null bs=5G count=1
0+1 records in
0+1 records out
2147479552 bytes (2.1 GB) copied, 0.983466 s, 2.2 GB/s

```

```
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	201824	-1
/dev/sdb1                              	partition	2097148	3448	10
[root@node1 ~]# dd if=/dev/zero of=/dev/null bs=5G count=1
0+1 records in
0+1 records out
2147479552 bytes (2.1 GB) copied, 0.785665 s, 2.7 GB/s
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	201824	-1
/dev/sdb1                              	partition	2097148	11596	10
[root@node1 ~]# 

```

用一个文件创建swap分区

```
[root@node1 ~]# dd if=/dev/zero of=/swapfile bs=1M count=2048
2048+0 records in
2048+0 records out
2147483648 bytes (2.1 GB) copied, 4.97781 s, 431 MB/s
[root@node1 ~]# ll /swapfile -h
-rw-r--r--. 1 root root 2.0G Sep 13 22:42 /swapfile
[root@node1 ~]# mkswap /swapfile 
Setting up swapspace version 1, size = 2097148 KiB
no label, UUID=932b48b7-3aa8-4348-ac71-2c7de7846df8
[root@node1 ~]# blkid /swapfile
/swapfile: UUID="932b48b7-3aa8-4348-ac71-2c7de7846df8" TYPE="swap" 

```

编辑fstab

```
#
# /etc/fstab
# Created by anaconda on Thu Aug 27 20:50:19 2020
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/centos_node1-root /                       xfs     defaults        0 0
UUID=f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa /boot                   xfs     defaults        0 0
/dev/mapper/centos_node1-swap swap                    swap    defaults        0 0
UUID="def76c0e-9674-420b-8057-5e914ffd1018"  /mnt      xfs    defaults   0 0 
UUID="eebdded1-7050-4540-acd3-56e9f75e2e55"  swap         swap   pri=10  0  0
UUID="932b48b7-3aa8-4348-ac71-2c7de7846df8" swap    swap  defaults 0 0

~                                                                                          #
# /etc/fstab
# Created by anaconda on Thu Aug 27 20:50:19 2020
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/centos_node1-root /                       xfs     defaults        0 0
UUID=f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa /boot                   xfs     defaults        0 0
/dev/mapper/centos_node1-swap swap                    swap    defaults        0 0
UUID="def76c0e-9674-420b-8057-5e914ffd1018"  /mnt      xfs    defaults   0 0 
UUID="eebdded1-7050-4540-acd3-56e9f75e2e55"  swap         swap   pri=10  0  0
UUID="932b48b7-3aa8-4348-ac71-2c7de7846df8" swap    swap  defaults 0 0

~                                                                                          
```



开启swap

```
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	197004	-1
/dev/sdb1                              	partition	2097148	3304	10
[root@node1 ~]# swapon -a
swapon: /swapfile: insecure permissions 0644, 0600 suggested.
[root@node1 ~]# swapon -s
Filename				Type		Size	Used	Priority
/dev/dm-1                              	partition	2097148	196992	-1
/dev/sdb1                              	partition	2097148	3152	10
/swapfile                              	file	2097148	0	-2
[root@node1 ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.8G        130M         71M        752K        1.6G        1.4G
Swap:          6.0G        195M        5.8G

[root@node1 ~]# chmod 600 /swapfile 


```

bind一个文件

```
[root@node1 ~]# mkdir /mnt/boot
mkdir: cannot create directory ‘/mnt/boot’: File exists
[root@node1 ~]# mount -B /boot /mnt/boot
[root@node1 ~]# vim /etc/fstab 
[root@node1 ~]# 
/boot    /mnt/boot  none  bind  0  0

[root@node1 ~]# 
[root@node1 ~]# mount -a
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# 

```

挂载光盘

```
[root@node1 boot]# 
[root@node1 boot]# mkdir /mnt/cdrom
[root@node1 boot]# mount -a
mount: unknown filesystem type 'iso9600'
[root@node1 boot]# vim /etc/fstab 
/dev/sr0   /mnt/cdrom   iso9660  defaults  0 0

[root@node1 boot]# mount -a
mount: /dev/sr0 is write-protected, mounting read-only
[root@node1 boot]# 
[root@node1 boot]# 
[root@node1 boot]# cd /mnt/cdrom/
[root@node1 cdrom]# ls
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL

```

普通用户使用光盘资源：

```
[root@node1 ~]# systemctl start autofs
[root@node1 ~]# systemctl enable autofs
Created symlink from /etc/systemd/system/multi-user.target.wants/autofs.service to /usr/lib/systemd/system/autofs.service.
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# ls /misc/cd
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL
[root@node1 ~]# useradd wang
useradd: user 'wang' already exists
[root@node1 ~]# su - wang
[wang@node1 ~]$ cd /misc/cd/
[wang@node1 cd]$ ls
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL
[wang@node1 cd]$ 
[wang@node1 cd]$ 
[wang@node1 cd]$ 
[wang@node1 cd]$ df
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 7409708  10401748  42% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9244    924280   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
/dev/sr0                        8490330 8490330         0 100% /misc/cd
/dev/sda1                       1038336  182340    855996  18% /boot
tmpfs                            186708      12    186696   1% /run/user/42
tmpfs                            186708       0    186708   0% /run/user/0
[wang@node1 cd]$ 

```

目录迁移：home空间占用不足时

准备一个磁盘20G

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.


Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 
First sector (2048-20971519, default 2048): 
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-20971519, default 20971519): 
Using default value 20971519
Partition 1 of type Linux and of size 10 GiB is set

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xf4d4eafc

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048    20971519    10484736   83  Linux

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.

```

格式化分区

```
[root@node1 ~]# mkfs.xfs /dev/sdb1
mkfs.xfs: /dev/sdb1 appears to contain an existing filesystem (xfs).
mkfs.xfs: Use the -f option to force overwrite.
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# mkfs.xfs -f /dev/sdb1
meta-data=/dev/sdb1              isize=512    agcount=4, agsize=655296 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2621184, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0

```

挂载

```
root@node1 ~]# mkdir /mnt/home
mkdir: cannot create directory ‘/mnt/home’: File exists
[root@node1 ~]# mount /dev/sdb1 /mnt/home/
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  7.1G   10G  42% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sr0                       8.1G  8.1G     0 100% /mnt/cdrom
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/sdb1                       10G   33M   10G   1% /mnt/home

```

拷贝数据：

```

[root@node1 ~]# cp -a /home/. /mnt/home
[root@node1 ~]# 
[root@node1 ~]# ls /mnt/home/ -a
.  ..  magedu  shaoxh  wang
[root@node1 ~]# du -sh /mnt/home
8.2M	/mnt/home
[root@node1 ~]# du -sh /home
8.2M	/home
[root@node1 ~]# 


```

设置开机挂载

```
[root@node1 ~]# vim /etc/fstab 
UUID="9a2037f0-0647-4b64-8146-6a39e63a5831"   /home   xfs    defaults  0 0

[root@node1 ~]# 
[root@node1 ~]# mount -a 
\[root@node1 ~]# mount -a 
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  7.1G   10G  42% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sr0                       8.1G  8.1G     0 100% /mnt/cdrom
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/sdb1                       10G   41M   10G   1% /home
You have new mail in /var/spool/mail/root
[root@node1 ~]# mount 
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
devtmpfs on /dev type devtmpfs (rw,nosuid,seclabel,size=917604k,nr_inodes=229401,mode=755)
securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev,seclabel)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000)
tmpfs on /run type tmpfs (rw,nosuid,nodev,seclabel,mode=755)
tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,seclabel,mode=755)
cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime)
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_prio,net_cls)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpuacct,cpu)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)
configfs on /sys/kernel/config type configfs (rw,relatime)
/dev/mapper/centos_node1-root on / type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
selinuxfs on /sys/fs/selinux type selinuxfs (rw,relatime)
systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=25,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=11108)
mqueue on /dev/mqueue type mqueue (rw,relatime,seclabel)
hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,seclabel)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
nfsd on /proc/fs/nfsd type nfsd (rw,relatime)
/dev/sr0 on /mnt/cdrom type iso9660 (ro,relatime)
/dev/sda1 on /boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
/dev/sda1 on /mnt/boot type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
sunrpc on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw,relatime)
/etc/auto.misc on /misc type autofs (rw,relatime,fd=5,pgrp=1184,timeout=300,minproto=5,maxproto=5,indirect,pipe_ino=24275)
-hosts on /net type autofs (rw,relatime,fd=11,pgrp=1184,timeout=300,minproto=5,maxproto=5,indirect,pipe_ino=24304)
tmpfs on /run/user/42 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700,uid=42,gid=42)
tmpfs on /run/user/0 type tmpfs (rw,nosuid,nodev,relatime,seclabel,size=186708k,mode=700)
/dev/sdb1 on /mnt/home type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
/dev/sdb1 on /home type xfs (rw,relatime,seclabel,attr2,inode64,noquota)
[root@node1 ~]# 

```

查看home数据，卸载，并且删除原来的home数据

```
[root@node1 ~]# ls /home/
magedu  shaoxh  wang
[root@node1 ~]# du -sh
260K	.
[root@node1 ~]# du -sh /home/
8.2M	/home/
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# umount /home
[root@node1 ~]# rm -rf /home/*
[root@node1 ~]# mount -a
[root@node1 ~]# ls /home/
magedu  shaoxh  wang
[root@node1 ~]# umount /mnt/home

```

一般进入单用户模式操作：维护模式

CentOS7：init 1 



**使用光盘**

在图形环境下自动启动挂载 /run/media/<user>/<label>

```
[root@node1 ~]# df
Filesystem                    1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root  17811456 7409008  10402448  42% /
devtmpfs                         917604       0    917604   0% /dev
tmpfs                            933524       0    933524   0% /dev/shm
tmpfs                            933524    9248    924276   1% /run
tmpfs                            933524       0    933524   0% /sys/fs/cgroup
/dev/sdb1                      10474496   41372  10433124   1% /home
/dev/sda1                       1038336  182340    855996  18% /boot
tmpfs                            186708      32    186676   1% /run/user/0
/dev/sr0                        8490330 8490330         0 100% /run/media/root/CentOS 7 x86_64

```

否则必须使用手动挂载

​      

```
[root@node1 ~]# mount /dev/cdrom /mnt
mount: /dev/sr0 is write-protected, mounting read-only
[root@node1 ~]# ls /mnt
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL
[root@node1 ~]# 

```

操作光盘：虚拟机自动挂载的光盘会被弹出，设置--已连接断开

```
[root@node1 ~]# 
[root@node1 ~]# eject 
[root@node1 ~]# eject -t    弹入  ，虚拟机， 笔记本不行

```

制作iso文件，利用光盘

```
[root@node1 ~]# 
[root@node1 ~]# cp /dev/sr0 centos7.iso
^C
[root@node1 ~]# file centos7.iso 
centos7.iso: # ISO 9660 CD-ROM filesystem data 'CentOS 7 x86_64' (bootable)
[root@node1 ~]# 
[root@node1 ~]# mkdir /mnt/iso
[root@node1 ~]# mount centos7.iso /mnt/iso/
mount: /dev/loop0 is write-protected, mounting read-only
[root@node1 ~]# ls /mnt/iso/
CentOS_BuildTag  EFI  EULA  GPL  images  isolinux  LiveOS  Packages  repodata  RPM-GPG-KEY-CentOS-7  RPM-GPG-KEY-CentOS-Testing-7  TRANS.TBL
[root@node1 ~]# 

```

把一个文件夹打包成一个iso文件；

把/etc/打包成一个iso文件

```
[root@node1 ~]# mkisofs -r -o /data/etc.iso /etc
I: -input-charset not specified, using utf-8 (detected in locale settings)

```

查看大小

```
[root@node1 ~]# du -sh /etc
37M	/etc
[root@node1 ~]# ll /data/etc.iso 
-rw-r--r--. 1 root root 36296704 Sep 14 12:03 /data/etc.iso
[root@node1 ~]# 

```

挂载查看

```
[root@node1 ~]# mkdir /mnt/etc
[root@node1 ~]# mount /data/etc.iso /mnt/etc/
mount: /dev/loop1 is write-protected, mounting read-only
[root@node1 ~]# 

```

不能往里面写文件

```
[root@node1 ~]# mkdir /mnt/etc
[root@node1 ~]# mount /data/etc.iso /mnt/etc/
mount: /dev/loop1 is write-protected, mounting read-only
[root@node1 ~]# 

```

CentOS6：第一张盘里的包3千多个

```
[wang@bogon cd]$ ls /misc/cd/Packages/*.rpm |wc -l 
3206
[wang@bogon cd]$ yum repolist
Loaded plugins: fastestmirror, refresh-packagekit, security
Loading mirror speeds from cached hostfile
 * base: mirrors.bfsu.edu.cn
 * extras: mirrors.neusoft.edu.cn
 * updates: mirrors.neusoft.edu.cn
repo id                                                                                         repo name                                                                                                   status
base                                                                                            CentOS-6 - Base                                                                                             6,713

```

查上U盘：此电脑--查看---详细信息--最上面的第二行文件系统

fa't'32

连接虚拟机就点击右下角的U盘按钮：选择设置3.0

```
[root@node1 etc]# tail -f /var/log/messages
Sep 14 12:24:06 node1 kernel: usb 1-1: SerialNumber: 0001
Sep 14 12:24:06 node1 mtp-probe: checking bus 1, device 2: "/sys/devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1"
Sep 14 12:24:06 node1 mtp-probe: bus: 1, device: 2 was not an MTP device
Sep 14 12:24:06 node1 kernel: Linux video capture interface: v2.00
Sep 14 12:24:06 node1 kernel: uvcvideo: Found UVC 1.00 device Integrated Camera (13d3:56a6)
Sep 14 12:24:06 node1 kernel: input: Integrated Camera as /devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1/1-1:1.0/input/input6
Sep 14 12:24:06 node1 kernel: usbcore: registered new interface driver uvcvideo
Sep 14 12:24:06 node1 kernel: USB Video Class driver (1.1.1)
Sep 14 12:24:22 node1 journal: No devices in use, exit
Sep 14 12:26:55 node1 kernel: usb 1-1: USB disconnect, device number 2
Sep 14 12:27:30 node1 rtkit-daemon[737]: The canary thread is apparently starving. Taking action.
Sep 14 12:27:30 node1 rtkit-daemon[737]: Demoting known real-time threads.
Sep 14 12:27:30 node1 rtkit-daemon[737]: Demoted 0 threads.
Sep 14 12:27:35 node1 kernel: usb 1-1: new high-speed USB device number 3 using ehci-pci
Sep 14 12:27:36 node1 kernel: usb 1-1: New USB device found, idVendor=13d3, idProduct=56a6
Sep 14 12:27:36 node1 kernel: usb 1-1: New USB device strings: Mfr=3, Product=1, SerialNumber=2
Sep 14 12:27:36 node1 kernel: usb 1-1: Product: Integrated Camera
Sep 14 12:27:36 node1 kernel: usb 1-1: Manufacturer: Azurewave
Sep 14 12:27:36 node1 kernel: usb 1-1: SerialNumber: 0001
Sep 14 12:27:36 node1 kernel: uvcvideo: Found UVC 1.00 device Integrated Camera (13d3:56a6)
Sep 14 12:27:36 node1 kernel: input: Integrated Camera as /devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1/1-1:1.0/input/input7
Sep 14 12:27:36 node1 mtp-probe: checking bus 1, device 3: "/sys/devices/pci0000:00/0000:00:11.0/0000:02:03.0/usb1/1-1"
Sep 14 12:27:36 node1 mtp-probe: bus: 1, device: 3 was not an MTP device

```

如果连接成功会有磁盘

```
[root@node1 ~]# lsblk    查看有几块设备
root@node1 ~]# mkdir /mnt/sde{1,2}
[root@node1 ~]# blkid
[root@node1 ~]# mount /dev/sde1 /mnt/sde1
[root@node1 ~]# locate ntfs.ko
[root@node1 ~]# locate vfat.ko
/usr/lib/modules/3.10.0-693.el7.x86_64/kernel/fs/fat/vfat.ko.xz
[root@node1 ~]# lsmod|grep fat
[root@node1 ~]# mount /dev/sde2 /mnt/sde2
[root@node1 ~]# lsmod|grep fat
[root@node1 ~]# ls /mnt/sde2/


fat文件系统没有权限  没有属组属性 ，不区分字母大小写


```

df -P显示对齐

```
root@bogon ~]# cat /etc/redhat-lsb/
cat: /etc/redhat-lsb/: Is a directory
[root@bogon ~]# 
[root@bogon ~]# cat /etc/redhat-release 
CentOS release 6.8 (Final)
[root@bogon ~]# 
[root@bogon ~]# 
[root@bogon ~]# ll /dev/sda
brw-rw----. 1 root disk 8, 0 Sep 13 21:35 /dev/sda
[root@bogon ~]# ll /dev/sda1
brw-rw----. 1 root disk 8, 1 Sep 13 21:35 /dev/sda1
[root@bogon ~]# 
[root@bogon ~]# 
[root@bogon ~]# mknod /dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx b 8 1
[root@bogon ~]# mount /dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx /mnt
[root@bogon ~]# df 
Filesystem           1K-blocks    Used Available Use% Mounted on
/dev/mapper/VolGroup-lv_root
                      18003272 3949612  13132472  24% /
tmpfs                   502068      80    501988   1% /dev/shm
/dev/sda1               487652   34876    427176   8% /boot
/dev/sdb1               487652   34876    427176   8% /mnt
/dev/sr0               3824484 3824484         0 100% /media/CentOS_6.8_Final
/dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                        487652   34876    427176   8% /mnt
[root@bogon ~]# df -P
Filesystem                             1024-blocks    Used Available Capacity Mounted on
/dev/mapper/VolGroup-lv_root              18003272 3949612  13132472      24% /
tmpfs                                       502068      80    501988       1% /dev/shm
/dev/sda1                                   487652   34876    427176       8% /boot
/dev/sdb1                                   487652   34876    427176       8% /mnt
/dev/sr0                                   3824484 3824484         0     100% /media/CentOS_6.8_Final
/dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx      487652   34876    427176       8% /mnt
[root@bogon ~]# 

```

查看df命令的版本信息

```
[root@bogon ~]# 
[root@bogon ~]# which df 
/bin/df
[root@bogon ~]# 
[root@bogon ~]# 
[root@bogon ~]# rpm -qf `which df `
coreutils-8.4-43.el6.x86_64
[root@bogon ~]# rpm -qf `which --skip-alias df `
coreutils-8.4-43.el6.x86_64
[root@bogon ~]# 

```

```
[root@bogon ~]# df -H
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup-lv_root
                       19G  4.1G   14G  24% /
tmpfs                 515M   82k  515M   1% /dev/shm
/dev/sda1             500M   36M  438M   8% /boot
/dev/sdb1             500M   36M  438M   8% /mnt
/dev/sr0              4.0G  4.0G     0 100% /media/CentOS_6.8_Final
/dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                      500M   36M  438M   8% /mnt
[root@bogon ~]# du -sh /boot
32M	/boot

```

创建一个稀疏文件：

```
[root@bogon ~]# dd if=/dev/zero of=/boot/test bs=1G count=0 seek=10
0+0 records in
0+0 records out
0 bytes (0 B) copied, 0.00015631 s, 0.0 kB/s
[root@bogon ~]# ll /boot/test -h
-rw-r--r--. 1 root root 10G Sep 14 14:25 /boot/test
[root@bogon ~]# df -H
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup-lv_root
                       19G  4.1G   14G  24% /
tmpfs                 515M   82k  515M   1% /dev/shm
/dev/sda1             500M   36M  438M   8% /boot
/dev/sdb1             500M   36M  438M   8% /mnt
/dev/sr0              4.0G  4.0G     0 100% /media/CentOS_6.8_Final
/dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                      500M   36M  438M   8% /mnt
[root@bogon ~]# du -sh /boot
32M	/boot

```

二进制查看：

```
[root@bogon ~]# hexdump -C /boot/test 
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*

```

在/data/下面创建一个稀疏文件

```
[root@bogon ~]# 
[root@bogon ~]# dd if=/dev/zero of=/data/test bs=1G count=1 seek=10
1+0 records in
1+0 records out
1073741824 bytes (1.1 GB) copied, 26.4696 s, 40.6 MB/s
[root@bogon ~]# df -h
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/VolGroup-lv_root
                       18G  4.8G   12G  30% /
tmpfs                 491M   80K  491M   1% /dev/shm
/dev/sda1             477M   35M  418M   8% /boot
/dev/sdb1             477M   35M  418M   8% /mnt
/dev/sr0              3.7G  3.7G     0 100% /media/CentOS_6.8_Final
/dev/sdaxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                      477M   35M  418M   8% /mnt
[root@bogon ~]# du -sh /data/test 
1.1G	/data/test
[root@bogon ~]# 

```

du统计的层级

```
root@bogon ~]# du --max-depth=2 /boot
276	/boot/grub
13	/boot/lost+found
254	/boot/efi/EFI
256	/boot/efi
32598	/boot

```

创建一个3个字节的文件

```
[root@node1 ~]# rm -rf /data/*
[root@node1 ~]# du -sh /data/
0	/data/
[root@node1 ~]# dd if=/dev/zero of=/data/f1 bs=1 count=3
3+0 records in
3+0 records out
3 bytes (3 B) copied, 8.8903e-05 s, 33.7 kB/s
[root@node1 ~]# ll /data/f1
-rw-r--r--. 1 root root 3 Sep 14 14:38 /data/f1
[root@node1 ~]# du -sh /data/
4.0K	/data/

```

创建一个空文件，不占用空间，但是加上换行符就占用一个块大小，

```
[root@node1 ~]# touch /data/f2
[root@node1 ~]# du -sh /data/f2
0	/data/f2
[root@node1 ~]# du -sh /data
4.0K	/data
[root@node1 ~]# echo >> /data/f2
[root@node1 ~]# ll /data/f2
-rw-r--r--. 1 root root 1 Sep 14 14:41 /data/f2
[root@node1 ~]# du -sh /data/
8.0K	/data/

```

截断输出

```
[root@node1 ~]# echo {0..9}|tr -d ' '
0123456789
[root@node1 ~]# echo {0..9}|tr -d ' ' > /data/f1
[root@node1 ~]# echo {a..z}|
> ^C
[root@node1 ~]# echo {a..z}|tr -d ' ' > /data/f2
[root@node1 ~]# dd if=/data/f1 of=/data/f2 bs=1 skip=2 seek=3 count=4
4+0 records in
4+0 records out
4 bytes (4 B) copied, 0.000114813 s, 34.8 kB/s
[root@node1 ~]# cat /data/f2 
abc2345[root@node1 ~]# 

```

不截断输出

```
[root@node1 ~]# !600
echo {0..9}|tr -d ' ' > /data/f1
[root@node1 ~]# !602
echo {a..z}|tr -d ' ' > /data/f2
[root@node1 ~]# dd if=/data/f1 of=/data/f2 bs=1 skip=2 seek=3 count=4 conv=notrunc
4+0 records in
4+0 records out
4 bytes (4 B) copied, 8.4739e-05 s, 47.2 kB/s
[root@node1 ~]# cat /data/f2
abc2345hijklmnopqrstuvwxyz
[root@node1 ~]# 

```

写入时的真实速度：默认时写入缓冲区，然后在写入磁盘

```
[root@node1 ~]# dd if=/dev/zero of=/data/bigfile bs=1G count=2 
2+0 records in
2+0 records out
2147483648 bytes (2.1 GB) copied, 19.1695 s, 112 MB/s
[root@node1 ~]# dd if=/dev/zero of=/data/bigfile bs=1G count=2 conv=fdatasync
2+0 records in
2+0 records out
2147483648 bytes (2.1 GB) copied, 3.25137 s, 660 MB/s
[root@node1 ~]# 

```

 **LVM**

添加两块硬盘，一个分区一个不分区

```
[root@node1 ~]# echo "- - -" > /sys/class/scsi_host/host0/scan 
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
sdc                     8:32   0    5G  0 disk 
sr0                    11:0    1 1024M  0 rom  

```

sdb分区

```
[root@node1 ~]# fdisk /dev/sdb
Welcome to fdisk (util-linux 2.23.2).

Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table
Building a new DOS disklabel with disk identifier 0xfcb0c833.

Command (m for help): n
Partition type:
   p   primary (0 primary, 0 extended, 4 free)
   e   extended
Select (default p): p
Partition number (1-4, default 1): 
First sector (2048-20971519, default 2048): 
Using default value 2048
Last sector, +sectors or +size{K,M,G} (2048-20971519, default 20971519): 
Using default value 20971519
Partition 1 of type Linux and of size 10 GiB is set

Command (m for help): t
Selected partition 1
Hex code (type L to list all codes): 8e 
Changed type of partition 'Linux' to 'Linux LVM'

Command (m for help): p

Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0xfcb0c833

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1            2048    20971519    10484736   8e  Linux LVM

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.

```

查看当前的物理卷

```
[root@node1 ~]# pvdisplay 
  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               centos_node1
  PV Size               <19.00 GiB / not usable 3.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              4863
  Free PE               0
  Allocated PE          4863
  PV UUID               WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO
   
[root@node1 ~]# pvs
  PV         VG           Fmt  Attr PSize   PFree
  /dev/sda2  centos_node1 lvm2 a--  <19.00g    0 

```

创建物理券

```
[root@node1 ~]# 
[root@node1 ~]# pvcreate /dev/sdb1 /dev/sdc
  Physical volume "/dev/sdb1" successfully created.
  Physical volume "/dev/sdc" successfully created.
[root@node1 ~]# 

```

查看

```
[root@node1 ~]# pvs
  PV         VG           Fmt  Attr PSize   PFree  
  /dev/sda2  centos_node1 lvm2 a--  <19.00g      0 
  /dev/sdb1               lvm2 ---  <10.00g <10.00g
  /dev/sdc                lvm2 ---    5.00g   5.00g
[root@node1 ~]# pvdisplay 
  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               centos_node1
  PV Size               <19.00 GiB / not usable 3.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              4863
  Free PE               0
  Allocated PE          4863
  PV UUID               WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO
   
  "/dev/sdb1" is a new physical volume of "<10.00 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sdb1
  VG Name               
  PV Size               <10.00 GiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               yd7HPp-SJ5I-yXzh-WxRt-pq5b-24Qs-ll4x7j
   
  "/dev/sdc" is a new physical volume of "5.00 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/sdc
  VG Name               
  PV Size               5.00 GiB
  Allocatable           NO
  PE Size               0   
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               K9Y3Py-4NWt-3CkN-7iJZ-hcjM-A8Aj-5qcQ8X

```

查看当前券组

```
[root@node1 ~]# vgs
  VG           #PV #LV #SN Attr   VSize   VFree
  centos_node1   1   2   0 wz--n- <19.00g    0 

```

创建券组

```
[root@node1 ~]# vgcreate vg0 /dev/sdb1 /dev/sdc
  Volume group "vg0" successfully created
[root@node1 ~]# pvs
  PV         VG           Fmt  Attr PSize   PFree  
  /dev/sda2  centos_node1 lvm2 a--  <19.00g      0 
  /dev/sdb1  vg0          lvm2 a--  <10.00g <10.00g
  /dev/sdc   vg0          lvm2 a--   <5.00g  <5.00g
[root@node1 ~]# pvdisplay 
  --- Physical volume ---
  PV Name               /dev/sda2
  VG Name               centos_node1
  PV Size               <19.00 GiB / not usable 3.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              4863
  Free PE               0
  Allocated PE          4863
  PV UUID               WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO
   
  --- Physical volume ---
  PV Name               /dev/sdb1
  VG Name               vg0
  PV Size               <10.00 GiB / not usable 3.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              2559
  Free PE               2559
  Allocated PE          0
  PV UUID               yd7HPp-SJ5I-yXzh-WxRt-pq5b-24Qs-ll4x7j
   
  --- Physical volume ---
  PV Name               /dev/sdc
  VG Name               vg0
  PV Size               5.00 GiB / not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               1279
  Allocated PE          0
  PV UUID               K9Y3Py-4NWt-3CkN-7iJZ-hcjM-A8Aj-5qcQ8X
   

```

查看vg

```
[root@node1 ~]# vgs
  VG           #PV #LV #SN Attr   VSize   VFree 
  centos_node1   1   2   0 wz--n- <19.00g     0 
  vg0            2   0   0 wz--n-  14.99g 14.99g

```

创建逻辑卷： -L是大小  -l是pe个数

```
[root@node1 ~]# lvcreate -n mysql -L 8G vg0
  Logical volume "mysql" created.
[root@node1 ~]# 

```

查看lv

```
[root@node1 ~]# lvs
  LV    VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root  centos_node1 -wi-ao---- <17.00g                                                    
  swap  centos_node1 -wi-ao----   2.00g                                                    
  mysql vg0          -wi-a-----   8.00g                                                    
[root@node1 ~]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/centos_node1/swap
  LV Name                swap
  VG Name                centos_node1
  LV UUID                Ylkuid-25VP-rQRT-9vBj-vIro-2Q1u-RIgtVo
  LV Write Access        read/write
  LV Creation host, time bogon, 2020-08-27 20:50:15 +0800
  LV Status              available
  # open                 2
  LV Size                2.00 GiB
  Current LE             512
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1
   
  --- Logical volume ---
  LV Path                /dev/centos_node1/root
  LV Name                root
  VG Name                centos_node1
  LV UUID                Yw51Aq-MQMS-u78L-tNec-qykn-tTiJ-SsVLBz
  LV Write Access        read/write
  LV Creation host, time bogon, 2020-08-27 20:50:16 +0800
  LV Status              available
  # open                 1
  LV Size                <17.00 GiB
  Current LE             4351
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0
   
  --- Logical volume ---
  LV Path                /dev/vg0/mysql
  LV Name                mysql
  VG Name                vg0
  LV UUID                zj9ofS-EJEo-XAdB-WfV7-ApMm-GyHh-0gqzs0
  LV Write Access        read/write
  LV Creation host, time node1, 2020-09-14 17:35:45 +0800
  LV Status              available
  # open                 0
  LV Size                8.00 GiB
  Current LE             2048
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2

```

创建好的设备

```
[root@node1 ~]# ll /dev/vg0/mysql 
lrwxrwxrwx. 1 root root 7 Sep 14 17:35 /dev/vg0/mysql -> ../dm-2
[root@node1 ~]# ll /dev/mapper/vg0-mysql 
lrwxrwxrwx. 1 root root 7 Sep 14 17:35 /dev/mapper/vg0-mysql -> ../dm-2
[root@node1 ~]# 

```

创建文件系统：

```
[root@node1 ~]# mkfs.xfs /dev/vg0/mysql 
meta-data=/dev/vg0/mysql         isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0, sparse=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal log           bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
[root@node1 ~]# 

```

查看uuid

```
[root@node1 ~]# blkid 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
/dev/sdc: UUID="K9Y3Py-4NWt-3CkN-7iJZ-hcjM-A8Aj-5qcQ8X" TYPE="LVM2_member" 
/dev/sdb1: UUID="yd7HPp-SJ5I-yXzh-WxRt-pq5b-24Qs-ll4x7j" TYPE="LVM2_member" 
/dev/mapper/vg0-mysql: UUID="c71607f3-e153-456a-a446-35378d5df1c8" TYPE="xfs" 

```

挂载

```
[root@node1 ~]# mkdir /mnt/mysql
[root@node1 ~]# mount /dev/vg0/mysql /mnt/mysql/
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  3.9G   14G  23% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql          8.0G   33M  8.0G   1% /mnt/mysql

```

配置自动挂载

```
UUID="c71607f3-e153-456a-a446-35378d5df1c8"  /mnt/mysql  xfs  defaults 0 0 

```

测试速度：

```
[root@node1 ~]# mkdir /data
[root@node1 ~]# dd if=/dev/zero of=/data/f1 bs=1M count=1024
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 2.64842 s, 405 MB/s
[root@node1 ~]# dd if=/dev/zero of=/mnt/mysql/f1 bs=1M count=1024
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 0.608749 s, 1.8 GB/s

```

扩展lv

```
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  2
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               14.99 GiB
  PE Size               4.00 MiB
  Total PE              3838
  Alloc PE / Size       2048 / 8.00 GiB
  Free  PE / Size       1790 / 6.99 GiB
  VG UUID               ASQJ6k-nY5e-W7wB-pB14-BhOT-yMsh-ki5B2L
   
[root@node1 ~]# lvextend -l +100%free /dev/vg0/mysql
  Size of logical volume vg0/mysql changed from 8.00 GiB (2048 extents) to 14.99 GiB (3838 extents).
  Logical volume vg0/mysql successfully resized.
[root@node1 ~]# 

```

查看vg剩余：

```
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               14.99 GiB
  PE Size               4.00 MiB
  Total PE              3838
  Alloc PE / Size       3838 / 14.99 GiB
  Free  PE / Size       0 / 0   
  VG UUID               ASQJ6k-nY5e-W7wB-pB14-BhOT-yMsh-ki5B2L
   

```

查看lv多大

```
[root@node1 ~]# lvs
  LV    VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root  centos_node1 -wi-ao---- <17.00g                                                    
  swap  centos_node1 -wi-ao----   2.00g                                                    
  mysql vg0          -wi-ao----  14.99g                                      
```

查看文件系统占用的空间

```
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql          8.0G  1.1G  7.0G  13% /mnt/mysql

```

xfs文件系统扩展

```
[root@node1 ~]# 
[root@node1 ~]# xfs_growfs /mnt/mysql/
meta-data=/dev/mapper/vg0-mysql  isize=512    agcount=4, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0 spinodes=0
data     =                       bsize=4096   blocks=2097152, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 2097152 to 3930112
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           15G  1.1G   14G   7% /mnt/mysql

```

在添加一块硬盘d

```
[root@node1 ~]# !echo
echo "- - -" > /sys/class/scsi_host/host0/scan 
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
└─sdb1                  8:17   0   10G  0 part 
  └─vg0-mysql         253:2    0   15G  0 lvm  /mnt/mysql
sdc                     8:32   0    5G  0 disk 
└─vg0-mysql           253:2    0   15G  0 lvm  /mnt/mysql
sdd                     8:48   0    5G  0 disk 
sr0                    11:0    1 1024M  0 rom  

```

创建pv

```
[root@node1 ~]# blkid 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
/dev/sdc: UUID="K9Y3Py-4NWt-3CkN-7iJZ-hcjM-A8Aj-5qcQ8X" TYPE="LVM2_member" 
/dev/sdb1: UUID="yd7HPp-SJ5I-yXzh-WxRt-pq5b-24Qs-ll4x7j" TYPE="LVM2_member" 
/dev/mapper/vg0-mysql: UUID="c71607f3-e153-456a-a446-35378d5df1c8" TYPE="xfs" 
[root@node1 ~]# pvcreate /dev/sdd
  Physical volume "/dev/sdd" successfully created.
[root@node1 ~]# blkid 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
/dev/sdc: UUID="K9Y3Py-4NWt-3CkN-7iJZ-hcjM-A8Aj-5qcQ8X" TYPE="LVM2_member" 
/dev/sdb1: UUID="yd7HPp-SJ5I-yXzh-WxRt-pq5b-24Qs-ll4x7j" TYPE="LVM2_member" 
/dev/mapper/vg0-mysql: UUID="c71607f3-e153-456a-a446-35378d5df1c8" TYPE="xfs" 
/dev/sdd: UUID="PBn3yy-CPfg-EmRs-GqgR-WJ56-gy7O-TLR5XX" TYPE="LVM2_member" 

```

pv加入vg

```
[root@node1 ~]# vgs
  VG           #PV #LV #SN Attr   VSize   VFree
  centos_node1   1   2   0 wz--n- <19.00g    0 
  vg0            2   1   0 wz--n-  14.99g    0 
[root@node1 ~]# vgextend vg0 /dev/sdd
  Volume group "vg0" successfully extended
[root@node1 ~]# vgs
  VG           #PV #LV #SN Attr   VSize   VFree 
  centos_node1   1   2   0 wz--n- <19.00g     0 
  vg0            3   1   0 wz--n- <19.99g <5.00g
[root@node1 ~]# pvs
  PV         VG           Fmt  Attr PSize   PFree 
  /dev/sda2  centos_node1 lvm2 a--  <19.00g     0 
  /dev/sdb1  vg0          lvm2 a--  <10.00g     0 
  /dev/sdc   vg0          lvm2 a--   <5.00g     0 
  /dev/sdd   vg0          lvm2 a--   <5.00g <5.00g

```

在创建一个binlog的逻辑卷

```
[root@node1 ~]# lvcreate -n binlog -L 2G vg0
  Logical volume "binlog" created.
[root@node1 ~]# lvs
  LV     VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root   centos_node1 -wi-ao---- <17.00g                                                    
  swap   centos_node1 -wi-ao----   2.00g                                                    
  binlog vg0          -wi-a-----   2.00g                                                    
  mysql  vg0          -wi-ao----  14.99g                                          
```

创建文件系统：

```
   
[root@node1 ~]# mkfs.ext4 /dev/vg0/binlog 
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
131072 inodes, 524288 blocks
26214 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=536870912
16 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (16384 blocks): done
Writing superblocks and filesystem accounting information: done 


```

挂载

```
[root@node1 ~]# mkdir /mnt/binlog
[root@node1 ~]# mount /dev/vg0/binlog /mnt/binlog
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           15G  1.1G   14G   7% /mnt/mysql
/dev/mapper/vg0-binlog         2.0G  6.0M  1.8G   1% /mnt/binlog

```

扩展：

```
  VG Size               <19.99 GiB
  PE Size               4.00 MiB
  Total PE              5117
  Alloc PE / Size       4350 / 16.99 GiB
  Free  PE / Size       767 / <3.00 GiB
  VG UUID               ASQJ6k-nY5e-W7wB-pB14-BhOT-yMsh-ki5B2L
   
[root@node1 ~]# lvextend -l +767 /dev/vg0/binlog
  Size of logical volume vg0/binlog changed from 2.00 GiB (512 extents) to <5.00 GiB (1279 extents).
  Logical volume vg0/binlog successfully resized.
[root@node1 ~]# 

```

查看：文件系统没有增长

```
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           15G  1.1G   14G   7% /mnt/mysql
/dev/mapper/vg0-binlog         2.0G  6.0M  1.8G   1% /mnt/binlog

```

ext：扩展写的是 设备名   xfs 写的是挂载点

```
[root@node1 ~]# resize2fs  /dev/vg0/binlog 
resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/vg0/binlog is mounted on /mnt/binlog; on-line resizing required
old_desc_blocks = 1, new_desc_blocks = 1
The filesystem on /dev/vg0/binlog is now 1309696 blocks long.

[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           15G  1.1G   14G   7% /mnt/mysql
/dev/mapper/vg0-binlog         4.9G  8.0M  4.7G	 1% /mnt/binlog

```

不管是ext还是xfs文件系统：直接可以文件系统扩展

```
lvextend -r -l +500 /dev/vg0/binlog
lvextend -r -l +500 /dev/vg0/mysql 
```

在添加一块硬盘10G e盘

```
[root@node1 ~]# vgdisplay 
  --- Volume group ---
  VG Name               centos_node1
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <19.00 GiB
  PE Size               4.00 MiB
  Total PE              4863
  Alloc PE / Size       4863 / <19.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               scaFKG-uBGT-SgIs-I8oP-M8cD-kBd0-Y1yqfv
   
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        4
  Metadata Sequence No  7
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                4
  Act PV                4
  VG Size               29.98 GiB
  PE Size               4.00 MiB
  Total PE              7676
  Alloc PE / Size       5117 / <19.99 GiB
  Free  PE / Size       2559 / <10.00 GiB
  VG UUID               ASQJ6k-nY5e-W7wB-pB14-BhOT-yMsh-ki5B2L
   
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# lvextend -r -l +1000 /dev/vg0/mysql
  Size of logical volume vg0/mysql changed from 14.99 GiB (3838 extents) to <18.90 GiB (4838 extents).
  Logical volume vg0/mysql successfully resized.
meta-data=/dev/mapper/vg0-mysql  isize=512    agcount=8, agsize=524288 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=0 spinodes=0
data     =                       bsize=4096   blocks=3930112, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
log      =internal               bsize=4096   blocks=2560, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 3930112 to 4954112
[root@node1 ~]# vgdisplay 
  --- Volume group ---
  VG Name               centos_node1
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <19.00 GiB
  PE Size               4.00 MiB
  Total PE              4863
  Alloc PE / Size       4863 / <19.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               scaFKG-uBGT-SgIs-I8oP-M8cD-kBd0-Y1yqfv
   
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        4
  Metadata Sequence No  8
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                4
  Act PV                4
  VG Size               29.98 GiB
  PE Size               4.00 MiB
  Total PE              7676
  Alloc PE / Size       6117 / 23.89 GiB
  Free  PE / Size       1559 / <6.09 GiB
  VG UUID               ASQJ6k-nY5e-W7wB-pB14-BhOT-yMsh-ki5B2L
   
[root@node1 ~]# lvextend -r -l +1559 /dev/vg0/binlog
  Size of logical volume vg0/binlog changed from <5.00 GiB (1279 extents) to <11.09 GiB (2838 extents).
  Logical volume vg0/binlog successfully resized.
resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/mapper/vg0-binlog is mounted on /mnt/binlog; on-line resizing required
old_desc_blocks = 1, new_desc_blocks = 2
The filesystem on /dev/mapper/vg0-binlog is now 2906112 blocks long.

[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           19G  1.1G   18G   6% /mnt/mysql
/dev/mapper/vg0-binlog          11G   10M   11G   1% /mnt/binlog
[root@node1 ~]# 

```

缩容：取消挂载

```
[root@node1 ~]# df -T
Filesystem                    Type     1K-blocks    Used Available Use% Mounted on
/dev/mapper/centos_node1-root xfs       17811456 5098304  12713152  29% /
devtmpfs                      devtmpfs    917604       0    917604   0% /dev
tmpfs                         tmpfs       933524       0    933524   0% /dev/shm
tmpfs                         tmpfs       933524    9280    924244   1% /run
tmpfs                         tmpfs       933524       0    933524   0% /sys/fs/cgroup
/dev/sda1                     xfs        1038336  182340    855996  18% /boot
tmpfs                         tmpfs       186708      12    186696   1% /run/user/42
tmpfs                         tmpfs       186708       0    186708   0% /run/user/0
/dev/mapper/vg0-mysql         xfs       19806208 1081712  18724496   6% /mnt/mysql
/dev/mapper/vg0-binlog        ext4      11375808   10184  10863472   1% /mnt/binlog
[root@node1 ~]# umount /mnt/binlog/
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# resize2fs /dev/vg0/binlog  8G
resize2fs 1.42.9 (28-Dec-2013)
Please run 'e2fsck -f /dev/vg0/binlog' first.

[root@node1 ~]# e2fsck -f /dev/vg0/binlog
e2fsck 1.42.9 (28-Dec-2013)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/vg0/binlog: 11/729088 files (0.0% non-contiguous), 64706/2906112 blocks
[root@node1 ~]# resize2fs /dev/vg0/binlog  8G
resize2fs 1.42.9 (28-Dec-2013)
Resizing the filesystem on /dev/vg0/binlog to 2097152 (4k) blocks.
The filesystem on /dev/vg0/binlog is now 2097152 blocks long.


```

lv

```

[root@node1 ~]# lvs
  LV     VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root   centos_node1 -wi-ao---- <17.00g                                                    
  swap   centos_node1 -wi-ao----   2.00g                                                    
  binlog vg0          -wi-a----- <11.09g                                                    
  mysql  vg0          -wi-ao---- <18.90g                                                    
[root@node1 ~]# lvreduce -L 8G /dev/vg0/binlog 
  WARNING: Reducing active logical volume to 8.00 GiB.
  THIS MAY DESTROY YOUR DATA (filesystem etc.)
Do you really want to reduce vg0/binlog? [y/n]: y
  Size of logical volume vg0/binlog changed from <11.09 GiB (2838 extents) to 8.00 GiB (2048 extents).
  Logical volume vg0/binlog successfully resized.
[root@node1 ~]# lvs
  LV     VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root   centos_node1 -wi-ao---- <17.00g                                                    
  swap   centos_node1 -wi-ao----   2.00g                                                    
  binlog vg0          -wi-a-----   8.00g                                                    
  mysql  vg0          -wi-ao---- <18.90g                                                    
[root@node1 ~]# 

```

挂载：

```
[root@node1 ~]# mount /dev/vg0/binlog /mnt/binlog
[root@node1 ~]# df -h
Filesystem                     Size  Used Avail Use% Mounted on
/dev/mapper/centos_node1-root   17G  4.9G   13G  29% /
devtmpfs                       897M     0  897M   0% /dev
tmpfs                          912M     0  912M   0% /dev/shm
tmpfs                          912M  9.1M  903M   1% /run
tmpfs                          912M     0  912M   0% /sys/fs/cgroup
/dev/sda1                     1014M  179M  836M  18% /boot
tmpfs                          183M   12K  183M   1% /run/user/42
tmpfs                          183M     0  183M   0% /run/user/0
/dev/mapper/vg0-mysql           19G  1.1G   18G   6% /mnt/mysql
/dev/mapper/vg0-binlog         7.9G  9.0M  7.5G   1% /mnt/binlog

```

总结：

```
扩展逻辑卷时，先扩逻辑卷后扩文件系统
缩减时，先缩减文件系统后缩减逻辑卷
```

跨主机迁移卷组

准备一个10G的硬盘

```
[root@shaoxh ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0   20G  0 disk 
├─sda1            8:1    0    1G  0 part /boot
└─sda2            8:2    0   19G  0 part 
  ├─centos-root 253:0    0   17G  0 lvm  /
  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]
sdb               8:16   1 28.8G  0 disk /mnt
sr0              11:0    1  8.1G  0 rom  
[root@shaoxh ~]# 

```

创建pv

```
[root@node1 ~]# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[root@node1 ~]# 

```

c创建vg

```
[root@node1 ~]# vgcreate vg0 /dev/sdb
  Volume group "vg0" successfully created
[root@node1 ~]# 

```

创建lv

```
[root@node1 ~]# lvcreate -l 2559 -n mysql vg0
  Logical volume "mysql" created.
[root@node1 ~]# 
[root@node1 ~]# lvs
  LV    VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root  centos_node1 -wi-ao---- <17.00g                                                    
  swap  centos_node1 -wi-ao----   2.00g                                                    
  mysql vg0          -wi-a----- <10.00g                                 
```

```
[root@node1 ~]# mkfs.ext4 /dev/vg0/mysql 
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
655360 inodes, 2620416 blocks
131020 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2151677952
80 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done 

```

挂载：

```
[root@node1 ~]# mount /dev/vg0/mysql /mnt
[root@node1 ~]# cp /etc/* /mnt

```

在源主机上，

1.在旧的系统上，umount所以卷组上的逻辑卷

2.禁用卷组

```
[root@node1 ~]# vgchange -an vg0
  0 logical volume(s) in volume group "vg0" now active
   
[root@node1 ~]# lvdisplay 
  --- Logical volume ---
  LV Path                /dev/vg0/mysql
  LV Name                mysql
  VG Name                vg0
  LV UUID                GTy9uP-kwLj-fTbC-93kE-U6W4-AJjn-raEGSi
  LV Write Access        read/write
  LV Creation host, time node1, 2020-09-14 20:30:41 +0800
  LV Status              NOT available
  LV Size                <10.00 GiB
  Current LE             2559
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
   

```

3.导出卷组

```
[root@node1 ~]# vgexport vg0
  Volume group "vg0" successfully exported
[root@node1 ~]# pvscan 
  PV /dev/sdb     is in exported VG vg0 [<10.00 GiB / 0    free]
  PV /dev/sda2   VG centos_node1    lvm2 [<19.00 GiB / 0    free]
  Total: 2 [28.99 GiB] / in use: 2 [28.99 GiB] / in no VG: 0 [0   ]
[root@node1 ~]# vgdisplay 
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             exported/resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <10.00 GiB
  PE Size               4.00 MiB
  Total PE              2559
  Alloc PE / Size       2559 / <10.00 GiB
  Free  PE / Size       0 / 0   
  VG UUID               CiE0kb-q7g1-8F9D-Teig-pcUl-8Kxa-Un8WGg
   

```

拆卸旧硬盘，这里是复制的磁盘文件

**在目标主机上**

4.在新的系统上安装旧硬盘，并且导入卷组

```
[root@node2 ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0   20G  0 disk 
├─sda1            8:1    0    1G  0 part /boot
└─sda2            8:2    0   19G  0 part 
  ├─centos-root 253:0    0   17G  0 lvm  /
  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]
sr0              11:0    1 1024M  0 rom  
[root@node2 ~]# echo "- - -" > /sys/class/scsi_host/host2/scan 
[root@node2 ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0   20G  0 disk 
├─sda1            8:1    0    1G  0 part /boot
└─sda2            8:2    0   19G  0 part 
  ├─centos-root 253:0    0   17G  0 lvm  /
  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]
sdb               8:16   0   10G  0 disk 
sr0              11:0    1 1024M  0 rom  

```

```
[root@node2 ~]# vgimport vg0
  Volume group "vg0" successfully imported

```

5 vgchange –ay vg0  启用 

```
[root@node2 ~]# vgchange -ay vg0
  1 logical volume(s) in volume group "vg0" now active

```

6.mount 所以卷组上的逻辑卷

```
[root@node2 ~]# mount /dev/vg0/mysql /mnt
[root@node2 ~]# ls /mnt/
adjtime                  crypttab     
```



**转移逻辑空间**

2块硬盘 b=10G c=5G

```
[root@node1 ~]# echo "- - -" > /sys/class/scsi_host/host0/scan 
[root@node1 ~]# lsblk 
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
sdc                     8:32   0    5G  0 disk 
sr0                    11:0    1 1024M  0 rom  
[root@node1 ~]# 

```

1.创建pv

```
[root@node1 ~]# pvcreate /dev/sdb /dev/sdc
  Physical volume "/dev/sdb" successfully created.
  Physical volume "/dev/sdc" successfully created.

```

2.创建vg0

```
[root@node1 ~]# vgcreate vg0 /dev/sdc
  Volume group "vg0" successfully created
[root@node1 ~]# 

```

3.创建lv

```
[root@node1 ~]# lvcreate -n mysql -l 1279 vg0
  Logical volume "mysql" created.
[root@node1 ~]# lvs
  LV    VG           Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root  centos_node1 -wi-ao---- <17.00g                                                    
  swap  centos_node1 -wi-ao----   2.00g                                                    
  mysql vg0          -wi-a-----  <5.00g                 
```

4.把/dev/sdb 也加入vg0里面

```
[root@node1 ~]# vgextend vg0 /dev/sdb
  Volume group "vg0" successfully extended
[root@node1 ~]# vgs
  VG           #PV #LV #SN Attr   VSize   VFree  
  centos_node1   1   2   0 wz--n- <19.00g      0 
  vg0            2   1   0 wz--n-  14.99g <10.00g

```

```
[root@node1 ~]# mkfs.ext4 /dev/vg0/mysql 
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
655360 inodes, 2620416 blocks
131020 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2151677952
80 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
```

查看pv使用的容量：

```
[root@node1 ~]# pvdisplay 
  --- Physical volume ---
  PV Name               /dev/sdc
  VG Name               vg0
  PV Size               5.00 GiB / not usable 4.00 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               0
  Allocated PE          1279
  PV UUID               evvfUF-UyTl-2fPB-EnWh-Di18-RAxv-HccIVI
   
  --- Physical volume ---
  PV Name               /dev/sdb
  VG Name               vg0
  PV Size               10.00 GiB / not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              2559
  Free PE               2559
  Allocated PE          0
  PV UUID               V9px5c-m3uD-z4Xd-aaLx-7eec-ZnDP-XmlS6M
   

```

把sdc空间迁移到sdb里面去pvmove  必须在同一个vg。（把sdc里面的PE搬到sdb剩余空间里面去）

```
[root@node1 ~]# pvmove /dev/sdc
  /dev/sdc: Moved: 0.86%
  /dev/sdc: Moved: 100.00%

```

查看pv使用容量：

```
[root@node1 ~]# pvdisplay 
  --- Physical volume ---
  PV Name               /dev/sdc
  VG Name               vg0
  PV Size               5.00 GiB / not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               1279
  Allocated PE          0
  PV UUID               evvfUF-UyTl-2fPB-EnWh-Di18-RAxv-HccIVI
   
  --- Physical volume ---
  PV Name               /dev/sdb
  VG Name               vg0
  PV Size               10.00 GiB / not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              2559
  Free PE               1280
  Allocated PE          1279
  PV UUID               V9px5c-m3uD-z4Xd-aaLx-7eec-ZnDP-XmlS6M
   

```

**拆除硬盘**

1.查看vg0

```
[root@node1 ~]# vgdisplay 
  --- Volume group ---
  VG Name               vg0
  System ID             
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  6
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               1
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               14.99 GiB
  PE Size               4.00 MiB
  Total PE              3838
  Alloc PE / Size       1279 / <5.00 GiB
  Free  PE / Size       2559 / <10.00 GiB
  VG UUID               5wp0Qz-v5Jb-LMDb-K7V8-4LRs-XxrW-r7JANg
   

```

2.从卷组中移除

```
[root@node1 ~]# vgreduce vg0 /dev/sdc
  Removed "/dev/sdc" from volume group "vg0"

```

3.移除卷标

```
[root@node1 ~]# pvremove /dev/sdc
  Labels on physical volume "/dev/sdc" successfully wiped.
[root@node1 ~]# blkid 
/dev/mapper/centos_node1-root: UUID="d714d2e4-7eb9-404c-b1e7-c45061f8a7bb" TYPE="xfs" 
/dev/sda2: UUID="WDywuA-ZSeN-JMcc-HeR1-V5e0-xEX1-sYYGcO" TYPE="LVM2_member" 
/dev/sda1: UUID="f7d1f48d-3bc9-4ef5-9ddb-6f8d7c20f3aa" TYPE="xfs" 
/dev/mapper/centos_node1-swap: UUID="55babd12-9d3f-4e97-b703-ec9a57ec544f" TYPE="swap" 
/dev/sdb: UUID="V9px5c-m3uD-z4Xd-aaLx-7eec-ZnDP-XmlS6M" TYPE="LVM2_member" 
/dev/mapper/vg0-mysql: UUID="2c3c6015-3eca-4e85-8c06-900b61d675bc" TYPE="ext4" 

```

**删除逻辑卷**

umount 

1.lvremove  /dev/vg0/mysql

2.vgremove  vg0

3.pvremove /dev/sdc

**逻辑卷快照**

逻辑卷和快照大小可以不一样，但是必须在一个vg中。

创建一个逻辑卷

```
[root@node1 ~]# echo "- - -" > /sys/class/scsi_host/host0/scan 
[root@node1 ~]# lsblk
NAME                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda                     8:0    0   20G  0 disk 
├─sda1                  8:1    0    1G  0 part /boot
└─sda2                  8:2    0   19G  0 part 
  ├─centos_node1-root 253:0    0   17G  0 lvm  /
  └─centos_node1-swap 253:1    0    2G  0 lvm  [SWAP]
sdb                     8:16   0   10G  0 disk 
sr0                    11:0    1 1024M  0 rom  
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# pvcreate 
[root@node1 ~]# 
[root@node1 ~]# 
[root@node1 ~]# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.
[root@node1 ~]# vgcreate vg0 /dev/sdb
  Volume group "vg0" successfully created
[root@node1 ~]# lvcreate -n mysql -L 8G vg0
  Logical volume "mysql" created.

```

挂载：

```
[root@node1 ~]# mkfs.ext4 /dev/vg0/mysql 
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
524288 inodes, 2097152 blocks
104857 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2147483648
64 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done 

[root@node1 ~]# mount /dev/vg0/mysql /mnt
[root@node1 ~]# cp /etc/fstab /mnt/f1
[root@node1 ~]# cp /etc/issue /mnt/f2
[root@node1 ~]# cp /etc/passwd /mnt/f3

```

创建快照：

```
[root@node1 ~]# lvcreate -n mysql_snapshot -s -p r -l 511 /dev/vg0/mysql
  Using default stripesize 64.00 KiB.
  Logical volume "mysql_snapshot" created.
[root@node1 ~]# lvdisplay 
--- Logical volume ---
  LV Path                /dev/vg0/mysql
  LV Name                mysql
  VG Name                vg0
  LV UUID                O4pvqS-J3ih-8HYG-AWQ4-5GV6-ySgI-oS3vVZ
  LV Write Access        read/write
  LV Creation host, time node1, 2020-09-15 09:59:12 +0800
  LV snapshot status     source of
                         mysql_snapshot [active]
  LV Status              available
  # open                 1
  LV Size                8.00 GiB
  Current LE             2048
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2
   
  --- Logical volume ---
  LV Path                /dev/vg0/mysql_snapshot
  LV Name                mysql_snapshot
  VG Name                vg0
  LV UUID                XFF6Fm-ngdP-9uHd-drpc-6t2c-911C-fg3xMZ
  LV Write Access        read only
  LV Creation host, time node1, 2020-09-15 10:07:17 +0800
  LV snapshot status     active destination for mysql
  LV Status              available
  # open                 0
  LV Size                8.00 GiB
  Current LE             2048
  COW-table size         <2.00 GiB
  COW-table LE           511
  Allocated to snapshot  0.00%
  Snapshot chunk size    4.00 KiB
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:5

```

修改数据：

```
[root@node1 ~]# rm -rf /mnt/f
f1  f2  f3  
[root@node1 ~]# rm -rf /mnt/f1 
[root@node1 ~]# echo > /mnt/f2
[root@node1 ~]# touch /mnt/f4

```

挂载快照：

```
[root@node1 ~]# mkdir /snap
[root@node1 ~]# mount /dev/vg0/mysql_snapshot /snap/
mount: /dev/mapper/vg0-mysql_snapshot is write-protected, mounting read-only
[root@node1 ~]# 

```

查看snap里面的内容

```
[root@node1 ~]# cd /snap/
[root@node1 snap]# ls
f1  f2  f3  lost+found
[root@node1 snap]# ll
total 28
-rw-r--r--. 1 root root   477 Sep 15 10:01 f1
-rw-r--r--. 1 root root    23 Sep 15 10:01 f2
-rw-r--r--. 1 root root  2123 Sep 15 10:01 f3
drwx------. 2 root root 16384 Sep 15 10:00 lost+found
[root@node1 snap]# 

```

还原快照：



```
 umount /mnt/
  umount /snap/

[root@node1 ~]# lvconvert --merge /dev/vg0/mysql /dev/vg0/mysql_snapshot 
  vg0/mysql is not read-only - refusing to merge.
  Merging of volume vg0/mysql_snapshot started.
  mysql: Merged: 100.00%
[root@node1 ~]# mount /dev/vg0/mysql /mnt/
[root@node1 ~]# cd /mnt/
[root@node1 mnt]# ls
f1  f2  f3  lost+found
[root@node1 mnt]# 
[root@node1 mnt]# 

```

